---
aliases:
---

# מבוא
אף על פי שיש בכך חזרתיות מסוימת, אנו עוקבים אחר פיתוח דומה לזו שנעשתה ב[[FEM1_002 אלסטוסטטיקה חד-ממדית|ניתוח החד-ממדי בפרקים הקודמים]]. כדי לגזור צורה חלשה ישירה עבור גוף, אנו לוקחים את מאזן התנע הקווי $\nabla \cdot \boldsymbol{\sigma} + \mathbf{f} = 0$ (המציין את הצורה החזקה) ויוצרים מכפלה סקלרית עם פונקציית וקטור חלקה שרירותית $\boldsymbol{\nu}$, ומבצעים אינטגרציה על פני הגוף,

$$\int_{\Omega} (\nabla \cdot \boldsymbol{\sigma} + \mathbf{f}) \cdot \boldsymbol{\nu}\ \mathrm{d}\Omega = \int_{\Omega} \mathbf{r} \cdot \boldsymbol{\nu}\ \mathrm{d}\Omega = 0, \tag{6.1}$$

כאשר $\mathbf{r}$ הוא השארית ו-$\boldsymbol{\boldsymbol{\nu}}$ היא פונקציית מבחן.

![[{F1628201-F275-4878-95C6-35B2979F4D21}.png|bookhue|400]]
>תפוח אדמה הנדסי. [[FEM1_000 00350022 אלמנטים סופיים לאנליזה הנדסית#ביבליוגרפיה|(Zohdi, 2018)]].

אם נוסיף תנאי שאנו עושים זאת עבור כל פונקציות המבחן האפשריות ($\forall \boldsymbol{\nu}$), משוואה $\text{(6.1)}$ מרמזת ש- $r = 0$. לכן, אם כל פונקציית מבחן אפשרית נלקחה בחשבון, אז

$$\mathbf{r} = \nabla \cdot \boldsymbol{\sigma} + \mathbf{f} = 0 \tag{6.2}$$

על כל אזור סופי ב-$\Omega$. כתוצאה מכך, ההצהרות החלשות והחזקות יהיו שקולות בהינתן שהפתרון האמיתי חלק מספיק כדי שיהיה לו פתרון חזק. ברור ש-$\mathbf{r}$ לעולם לא יכול להיות שונה מאפס על פני אזור סופי כלשהו בגוף, מכיוון שפונקציית הבדיקה תאתר אותם. באמצעות כלל המכפלה של נגזרת,

$$\nabla \cdot (\boldsymbol{\sigma} \cdot \boldsymbol{\nu}) = (\nabla \cdot \boldsymbol{\sigma}) \cdot \boldsymbol{\nu} + \nabla\boldsymbol{\nu} : \boldsymbol{\sigma} \tag{6.3}$$

מוביל ל-$\forall \boldsymbol{\nu}$,

$$\int_{\Omega} (\nabla \cdot (\boldsymbol{\sigma} \cdot \boldsymbol{\nu}) - \nabla\boldsymbol{\nu} : \boldsymbol{\sigma})\ \mathrm{d}\Omega + \int_{\Omega} \mathbf{f} \cdot \boldsymbol{\nu}\ \mathrm{d}\Omega = 0, \tag{6.4}$$

כאשר אנו בוחרים את $\boldsymbol{\nu}$ מתוך קבוצה קבילה, שנדון בה בהמשך. באמצעות [[CAL2_014 אינטגרלים משטחיים#משפט גאוס|משפט גאוס]], אנו מגיעים ל-$\forall \boldsymbol{\nu}$,

$$\int_{\Omega} \nabla\boldsymbol{\nu} : \boldsymbol{\sigma}\ \mathrm{d}\Omega = \int_{\Omega}\mathbf{f} \cdot \boldsymbol{\nu}\ \mathrm{d}\Omega + \int_{\partial\Omega} \boldsymbol{\sigma} \cdot \mathbf{n} \cdot \boldsymbol{\nu}\ \mathrm{d}A, \tag{6.5}$$

אשר, מכיוון שההטרחה $\mathbf{t} = \boldsymbol{\sigma} \cdot \mathbf{n}$, מוביל ל-

$$\int_{\Omega} \nabla\boldsymbol{\nu} : \boldsymbol{\sigma}\ \mathrm{d}\Omega = \int_{\Omega} \mathbf{f} \cdot \boldsymbol{\nu}\ \mathrm{d}\Omega + \int_{\Gamma_t} \boldsymbol{\sigma} \cdot \mathbf{n} \cdot \boldsymbol{\nu}\ \mathrm{d}A. \tag{6.6}$$

אם נחליט להגביל את הבחירות שלנו של $\boldsymbol{\nu}$ לאלה כך ש-$\boldsymbol{\nu}|_{\Gamma_u} = 0$, יש לנו,
כאשר $\mathbf{u}^*$ הוא התזוזה המוחלת על $\Gamma_u$, עבור אלסטיות ליניארית עם עיבור אינפיניטסימלי, הבעיה בצורתה החלשה היא:

מצאו $u$, $u|_{\Gamma_u} = u^*$, כך ש-$\forall \boldsymbol{\nu}$, $\boldsymbol{\nu}|_{\Gamma_u} = 0$:

$$ \underbrace{\int_{\Omega} \nabla\boldsymbol{\nu} : \mathbf{IE} : \nabla u\ \mathrm{d}\Omega \}}_{:= B(\mathbf{u},\, \boldsymbol{\nu})} =  \underbrace{\int_{\Omega} \mathbf{f} \cdot \boldsymbol{\nu}\ \mathrm{d}\Omega + \int_{\Gamma_t} \mathbf{t}^* \cdot \boldsymbol{\nu}\ \mathrm{d}A }_{:= F(\boldsymbol{\nu})}, \tag{6.7}$$

כאשר $\mathbf{t}=\mathbf{t}^{*}$ על $\Gamma_t$. כמו בניסוח החד-ממדי, זה נקרא "צורה חלשה" מכיוון שהיא אינה דורשת את הגזירות של המאמץ $\boldsymbol{\sigma}$. במילים אחרות, דרישות הגזירּות נחלשו. נדגיש שאם נבדוק את הפתרון עם כל פונקציות המבחן האפשריות של חלקות מספקת, אז הפתרון החלש שקול לפתרון החזק. יתר על כן, בהינתן שהפתרון האמיתי חלק מספיק, הצורות החלשה והחזקה הן שקולות.

# מרחבים סובולב הילברטיים

כמו בממד אחד, אחת משאלות המפתח היא בחירת פונקציות הבסיס בצורה החלשה. באופן נאיבי למדי, התשובה פשוטה - האינטגרלים חייבים להישאר סופיים.

באותו אופן כמו ב[[FEM1_002 אלסטוסטטיקה חד-ממדית#מרחב סובולב הילברטי|חד-ממד]], אנו מגדירים את $\mathbf{H}^{1}(\Omega):=[H^{1}(\Omega)]^{3}$ כמרחב של פונקציות וקטוריות שרכיביהם ב- $H^{1}(\Omega)$, כלומר:
$$\begin{align}
 & \mathbf{u}\in \mathbf{H}^{1}(\Omega)\quad \mathrm{if}\quad \lVert \mathbf{u} \rVert ^{2}_{\mathbf{H}^{1}(\Omega)} \\[1ex]
 &\qquad \qquad  :=\int_{\Omega}^{} \sum_{j=1}^{3}\sum_{i=1}^{3} \dfrac{ \partial {u}_{i} }{ \partial {x}_{j} } \dfrac{ \partial {u}_{i} }{ \partial {x}_{j} }    \, \mathrm{d}\Omega+\int_{\Omega}^{} \sum_{i=1}^{3}{u}_{i}{u}_{i}  \, \mathrm{d}\Omega<\infty   \tag{6.9}
\end{align}$$

לפיכך, אנו מנסחים את הבעיה החלשה בצורה הבאה:

מצאו $u \in \mathbf{H}^1(\Omega)$, $u|_{\Gamma_u} = u^*$, כך ש-$\forall \boldsymbol{\nu} \in \mathbf{H}^1(\Omega)$, $\boldsymbol{\nu}|_{\Gamma_u} = 0$:

$$\boxed {
\int_{\Omega} \nabla\boldsymbol{\nu} : \mathbf{IE} : \nabla \mathbf{u}\ \mathrm{d}\Omega = \int_{\Omega} \mathbf{f} \cdot \boldsymbol{\nu}\ \mathrm{d}\Omega + \int_{\Gamma_t} \mathbf{t}^* \cdot \boldsymbol{\nu}\ \mathrm{d}A 
 }\tag{6.10}$$

# קירוב אלמנטים סופיים (FEM)

נוח לרשום את התבנית הבילינארית בצורה מטריציונית באופן הבא:

$$ \begin{align}
\int_{\Omega} ([\mathbf{D}]\{\boldsymbol{\nu}\})^T [\mathbf{IE}]([\mathbf{D}]\{\mathbf{u}\}) \mathrm{d}\Omega  & = \int_{\Omega} \{\boldsymbol{\nu}\}^T \{\mathbf{f}\} \mathrm{d}\Omega \\[1ex]
 &  + \int_{\Gamma_t} \{\boldsymbol{\nu}\}^T \{\mathbf{t}^*\} \mathrm{d}A\tag{7.4}  \\[1ex]
\end{align} $$
כאשר $[\mathbf{D}]$, טנזור הדפורמציה (עיבור), מוגדר כ:

$$ \begin{align}
 & [\mathbf{D}] := \begin{pmatrix} \frac{\partial}{\partial x_1} & 0 & 0 \\ 0 & \frac{\partial}{\partial x_2} & 0 \\ 0 & 0 & \frac{\partial}{\partial x_3} \\ \frac{\partial}{\partial x_2} & \frac{\partial}{\partial x_1} & 0 \\ 0 & \frac{\partial}{\partial x_3} & \frac{\partial}{\partial x_2} \\ \frac{\partial}{\partial x_3} & 0 & \frac{\partial}{\partial x_1} \end{pmatrix}\qquad \{\mathbf{u}\} := \begin{pmatrix} u_1 \\ u_2 \\ u_3 \end{pmatrix},  \\[3ex]
 &  \{\mathbf{f}\} :=\begin{pmatrix} f_1 \\ f_2 \\ f_3 \end{pmatrix}, \quad \{\mathbf{t}^*\} := \begin{pmatrix} t_1^* \\ t_2^* \\ t_3^* \end{pmatrix} \tag{7.5}
\end{align}  $$

ברור שבמימוש שיטת האלמנטים הסופיים, יש לקחת בחשבון את דלילות המטריצה $[\mathbf{D}]$ (כלומר, העובדה שהיא מכילה אפסים רבים - sparse). כמו כן, נוח לרשום את הקירובים כך:

$$ \begin{aligned} u_1^h(x_1, x_2, x_3) &= \sum_{i=1}^{N} a_i \phi_i(x_1, x_2, x_3) \\ u_2^h(x_1, x_2, x_3) &= \sum_{i=1}^{N} a_{i+N} \phi_i(x_1, x_2, x_3) \\ u_3^h(x_1, x_2, x_3) &= \sum_{i=1}^{N} a_{i+2N} \phi_i(x_1, x_2, x_3) \end{aligned} \tag{7.6} $$

או $\{\mathbf{u}^h\} = [\boldsymbol{\phi}]\{\mathbf{a}\}$, כאשר, לדוגמה[^1]:

$$ [\boldsymbol{\phi}] := \begin{pmatrix} \phi_1 & \phi_2 & \dots & \phi_N & 0 & 0 & \dots & 0 & 0 & 0 & \dots & 0 \\ 0 & 0 & \dots & 0 & \phi_1 & \phi_2 & \dots & \phi_N & 0 & 0 & \dots & 0 \\ 0 & 0 & \dots & 0 & 0 & 0 & \dots & 0 & \phi_1 & \phi_2 & \dots & \phi_N \end{pmatrix} \tag{7.7} $$

נוח לרשום:

$$ \{\mathbf{a}\} := \begin{pmatrix} a_1 \\ a_2 \\ \vdots \\ a_{3N} \end{pmatrix}, \quad \{\boldsymbol{\phi}_i\} := \begin{cases} \begin{pmatrix} \phi_i \\ 0 \\ 0 \end{pmatrix} & \text{for } 1 \le i \le N \\[1ex] \begin{pmatrix} 0 \\ \phi_{i-N} \\ 0 \end{pmatrix} & \text{for } N+1 \le i \le 2N \\[1ex]\begin{pmatrix} 0 \\ 0 \\ \phi_{i-2N} \end{pmatrix} & \text{for } 2N+1 \le i \le 3N \end{cases} \tag{7.8} $$

וכן $\{\mathbf{u}^h\} = \sum_{i=1}^{3N} a_i \{\boldsymbol{\phi}_i\}$. אם נבחר את $\boldsymbol{\nu}$ עם אותו בסיס, אך עם צירוף לינארי שונה $\{\boldsymbol{\nu}^h\} = [\boldsymbol{\phi}]\{\mathbf{b}\}$, אז נוכל לכתוב:

$$ \begin{align}
 & \underbrace{ \int_{\Omega} ([\mathbf{D}][\boldsymbol{\phi}]\{\mathbf{b}\})^T [\mathbf{IE}]([\mathbf{D}][\boldsymbol{\phi}]\{\mathbf{a}\}) \mathrm{d}\Omega }_{ \{\mathbf{b}\}^T [\mathbf{K}]\{\mathbf{a}\} \text{ stiffness} }   = \underbrace{ \int_{\Omega} ([\boldsymbol{\phi}]\{\mathbf{b}\})^T \{\mathbf{f}\} \mathrm{d}\Omega }_{ \text{body load} } \\[1ex]
 & \qquad  + \underbrace{ \int_{\Gamma_t} ([\boldsymbol{\phi}]\{\mathbf{b}\})^T \{\mathbf{t}^*\} \mathrm{d}A }_{ \text{traction load} } \tag{7.9}
\end{align} $$

מכיוון ש-$\{\mathbf{b}\}$ שרירותי (כלומר $\forall \boldsymbol{\nu} \Rightarrow \forall \{\mathbf{b}\}$), נקבל:

*   $\{\mathbf{b}\}^T ([\mathbf{K}]\{\mathbf{a}\} - \{\mathbf{R}\}) = 0 \Rightarrow [\mathbf{K}]\{\mathbf{a}\} = \{\mathbf{R}\}$
*   $[\mathbf{K}] := \int_{\Omega} ([\mathbf{D}][\boldsymbol{\phi}])^T [\mathbf{IE}]([\mathbf{D}][\boldsymbol{\phi}]) \mathrm{d}\Omega$
*   $\{\mathbf{R}\} := \int_{\Omega} [\boldsymbol{\phi}]^T \{\mathbf{f}\} \mathrm{d}\Omega + \int_{\Gamma_t} [\boldsymbol{\phi}]^T \{\mathbf{t}^*\} \mathrm{d}A$

באופן מפורש, $[\mathbf{K}]\{\mathbf{a}\} = \{\mathbf{R}\}$ היא מערכת המשוואות שיש לפתור.

[^1]: הצגת הקירוב הנומרי בצורה זו נועדה להקל על הבנת התהליך. ברמת המימוש, לא היינו מאחסנים את המטריצות בצורה זו בשל המספר הגדול של אפסים.

# טרנספורמציות גלובליות/לוקליות

אחת החוזקות של שיטת האלמנטים הסופיים היא שרוב החישובים יכולים להתבצע באופן פרטני לכל אלמנט (element-by-element). אנו מגדירים את איברי $[\mathbf{K}]$:

$$ [\mathbf{K}] = \int_{\Omega} ([\mathbf{D}][\boldsymbol{\phi}])^T [\mathbf{IE}]([\mathbf{D}][\boldsymbol{\phi}]) \mathrm{d}\Omega \tag{7.10} $$

וכן

$$ \{\mathbf{R}\} = \int_{\Omega} [\boldsymbol{\phi}]^T \{\mathbf{f}\} \mathrm{d}\Omega + \int_{\Gamma_t} [\boldsymbol{\phi}]^T \{\mathbf{t}^*\} \mathrm{d}A \quad \tag{7.11} $$

בפירוק החישובים לאלמנטים, $[\mathbf{K}] = \sum_e [\mathbf{K}]^{e}$, כאשר $e = 1, 2, \dots$ (מספר האלמנטים), כאשר

$$ [\mathbf{K}]_e = \int_{\Omega_e} ([\mathbf{D}][\boldsymbol{\phi}])^T [\mathbf{IE}]([\mathbf{D}][\boldsymbol{\phi}]) \mathrm{d}\Omega_e \tag{7.12} $$
וכן
$$ \{\mathbf{R}\}_e = \int_{\Omega_e} [\boldsymbol{\phi}]^T \{\mathbf{f}\} \mathrm{d}\Omega_e + \int_{\Gamma_{t,e}} [\boldsymbol{\phi}]^T \{\mathbf{t}^*\} \mathrm{d}A_e  \tag{7.13} $$

כאשר $\Gamma_{u,e} = \Gamma_u \cap \partial\Omega_e$ וכן $\Gamma_{t,e} = \Gamma_t \cap \partial\Omega_e$. על מנת להפוך את החישובים לשיטתיים, אנו מעוניינים להשתמש באלמנט הכללי או "אלמנט המסטר" המוגדר במערכת קואורדינטות מקומית $(\zeta_1, \zeta_2, \zeta_3)$. בהתאם לכך, אנו זקוקים לפונקציות המיפוי הבאות, מקואורדינטות האלמנט הכללי לקואורדינטות במרחב האמיתי, $\mathbf{M}_{x\zeta}: (\zeta_1, \zeta_2, \zeta_3) \rightarrow (x_1, x_2, x_3)$ (לדוגמה, אלמנטים תלת-לינאריים):

$$ \begin{aligned} x_1 &= \sum_{i=1}^{8} X_{1i} \hat{\phi}_i := M_{x\zeta_1}(\zeta_1, \zeta_2, \zeta_3) \\ x_2 &= \sum_{i=1}^{8} X_{2i} \hat{\phi}_i := M_{x\zeta_2}(\zeta_1, \zeta_2, \zeta_3) \\ x_3 &= \sum_{i=1}^{8} X_{3i} \hat{\phi}_i := M_{x\zeta_3}(\zeta_1, \zeta_2, \zeta_3) \end{aligned} \tag{7.14} $$

כאשר $(X_{1i}, X_{2i}, X_{3i})$ הן הקואורדינטות המרחביות האמיתיות של הצומת ה-$i$, וכן $\hat{\phi}(\zeta_1, \zeta_2, \zeta_3) := \phi(x_1(\zeta_1, \zeta_2, \zeta_3), x_2(\zeta_1, \zeta_2, \zeta_3), x_3(\zeta_1, \zeta_2, \zeta_3))$. בדומה למקרה החד-ממדי, מיפויים מסוג זה נקראים בדרך כלל מיפויים פרמטריים. אם סדר הפולינום של פונקציות הצורה גבוה כמו זה של האלמנט, זהו מיפוי איזופרמטרי; אם נמוך יותר, תת-פרמטרי; ואם גבוה יותר, סופר-פרמטרי.

![[{338166AC-8CDC-4AFB-BED2-243CB80D51BB}.png|bookhue|400]]
>אלמנט סופי דו-ממדי. [[FEM1_000 00350022 אלמנטים סופיים לאנליזה הנדסית#ביבליוגרפיה|(Zohdi, 2018)]].

# יצירת רשת ופונקציות קישוריות

כדי לקשר בין המספור המקומי של הצמתים למספור הגלובלי, נדרשת שיטה פשוטה לאוטומציה של תהליך זה. עבור גאומטריות מסובכות, יש צורך במערך חיפוש (lookup array) המקשר בין מספר הצומת המקומי בתוך אלמנט למספר הגלובלי. חיבור גלובלי/מקומי חשוב מכיוון שמיקומם הנכון (הגלובלי) של האיברים במטריצת הקשיחות נדרש בעת פתרון מערכת המשוואות, בין אם על ידי [[NUM1_002 שיטות ישירות לפתרון מערכות לינאריות#אלגוריתם שיטת האלימינציה של גאוס|אלימינציית גאוס]] או בכפל אלמנט-אחר-אלמנט בשיטת פתרון מסוג Conjugate Gradient (CG).


| מספר אלמנט | צומת גלובלי 1 | צומת גלובלי 2 | צומת גלובלי 3 | צומת גלובלי 4 |
|------------|----------------|----------------|----------------|----------------|
| 1          | 1              | 2              | 3              | 4              |
| 2          | 2              | 3              | 4              | 5              |
| 3          | 7              | 8              | 9              | 10             |
| 4          | 6              | 7              | 8              | 9              |
>מספור גלובלי של צמתים עבור אלמנטים לדוגמה של קשת. כל שורה מייצגת אלמנט, והעמודות מייצגות את מספרי הצמתים הגלובליים המרכיבים אותו לפי סדר מקומי (צומת מקומי 1, 2, 3, 4). מספור זה הוא עבור המיפוי באיור הבא.

# מגבלות על אלמנטים

נזכיר שבחד-ממד יש לנו חישוב מהסוג הבא:

$$ 
\begin{align}
\int_{x}^{x+h} \frac{\mathrm{d}\phi_i}{\mathrm{d}x} E \frac{\mathrm{d}\phi_j}{\mathrm{d}x} \mathrm{d}x  & = \int_{-1}^{+1} \frac{\mathrm{d}\hat{\phi}_i}{\mathrm{d}\zeta} \frac{\mathrm{d}\zeta}{\mathrm{d}x} E \frac{\mathrm{d}\hat{\phi}_j}{\mathrm{d}\zeta} \frac{\mathrm{d}\zeta}{\mathrm{d}x} \frac{\mathrm{d}x}{\mathrm{d}\zeta} \mathrm{d}\zeta  \\[1ex]
 & = \int_{-1}^{+1} \frac{\mathrm{d}\hat{\phi}_i}{\mathrm{d}\zeta} E \frac{\mathrm{d}\hat{\phi}_j}{\mathrm{d}\zeta} \underbrace{\frac{\mathrm{d}\zeta}{\mathrm{d}x}}_{1/J} \mathrm{d}\zeta \tag{7.15}
\end{align}
$$
ברור שיעקוביאן אפס יוביל לבעיות ולאינטגרלים שעלולים להיות סינגולריים. בחד-ממד, היה קל להימנע מכך מכיוון שהצמתים ממוספרים באופן סדרתי, וכל עוד הצמתים אינם מתלכדים, הדבר לא יקרה, מאחר ש-$J = h/2$. עם זאת, ברור ש-$J < 0$ אינו פיזיקלי, מכיוון שמשמעותו היא שצמתים שכנים ממופים 'הפוך' (אחד דרך השני). יעקוביאנים שליליים יכולים גם להוביל למטריצות קשיחות לא מוגדרות (indefinite). כמו בניסוחים חד-ממדיים, בניסוחים דו-ממדיים ותלת-ממדיים, יש לוודא ש-$J := \det \mathbf{F} > 0$ בכל התחום. ישנן שתי דרכים שבהן יכולים להיווצר יעקוביאנים לא-חיוביים: (1) האלמנטים אינם קמורים (non-convex) ו-(2) מספור הצמתים שגוי, מה שגורם לאלמנטים 'להימשך הפוך'. עלינו להבטיח ש-$J > 0$, מכיוון של-$J$ יש משמעות פיזיקלית: הוא היחס בין הנפח הדיפרנציאלי של אלמנט המסטר לנפח הדיפרנציאלי של האלמנט הסופי. אם הצמתים ממוספרים נכון כדי להבטיח שהם לא 'נמשכים הפוך' (לדוגמה, ראו את האיור הבא) ושהאלמנטים קמורים, אז $J > 0$.

![[{99AE3837-9C33-4E04-BDEC-B8B1EFFC109E}.png|bookhue|500]]
>דוגמה לרשת ממופה עבור רצועה חצי מעגלית.

##  אלמנטים טובים ורעים: דוגמאות

נתבונן באלמנט לינארי דו-ממדי. פונקציות הצורה הן:

$$\begin{aligned}
\hat{\phi}_1(\zeta_1,\zeta_2) &= \frac{1}{4}(1-\zeta_1)(1-\zeta_2) \\[1ex]
\hat{\phi}_2(\zeta_1,\zeta_2) &= \frac{1}{4}(1+\zeta_1)(1-\zeta_2) \\[1ex]
\hat{\phi}_3(\zeta_1,\zeta_2) &= \frac{1}{4}(1+\zeta_1)(1+\zeta_2) \\[1ex]
\hat{\phi}_4(\zeta_1,\zeta_2) &= \frac{1}{4}(1-\zeta_1)(1+\zeta_2)
\end{aligned}$$

פונקציות המיפוי הן:

*   $x_1 = \sum_{i=1}^{4} X_{1i} \hat{\phi}_i := M_{x_1}(\zeta_1, \zeta_2)$
*   $x_2 = \sum_{i=1}^{4} X_{2i} \hat{\phi}_i := M_{x_2}(\zeta_1, \zeta_2)$

כאשר $(X_{1i}, X_{2i})$ הן הקואורדינטות המרחביות האמיתיות של הצומת ה-$i$, וכן $\hat{\phi}(\zeta_1, \zeta_2) := \phi(x_1(\zeta_1, \zeta_2), x_2(\zeta_1, \zeta_2))$. נבחן ארבע דוגמאות. כדי שהאלמנטים יהיו קבילים, היעקוביאן המתאים לטרנספורמציה $\mathrm{d}\mathbf{x} = \mathbf{F} \cdot \mathrm{d}\boldsymbol{\zeta}$ חייב להיות חיובי וסופי בכל האלמנט, כאשר:

$$ J := |\mathbf{F}| := \left| \frac{\partial(x_1, x_2)}{\partial(\zeta_1, \zeta_2)} \right| \quad \text{where} \quad \mathbf{F} := \begin{pmatrix} \frac{\partial x_1}{\partial \zeta_1} & \frac{\partial x_1}{\partial \zeta_2} \\ \frac{\partial x_2}{\partial \zeta_1} & \frac{\partial x_2}{\partial \zeta_2} \end{pmatrix} \tag{7.17} $$

באופן מפורש:

$$ J = |\mathbf{F}| = \frac{\partial x_1}{\partial \zeta_1} \frac{\partial x_2}{\partial \zeta_2} - \frac{\partial x_2}{\partial \zeta_1} \frac{\partial x_1}{\partial \zeta_2} \tag{7.18} $$

![[{C880F6AD-28C8-4DA8-80A0-7E8A5F7B2219}.png|bookhue|600]]
>אלמנט לינארי דו-ממדי ודוגמאות למיפוי. [[FEM1_000 00350022 אלמנטים סופיים לאנליזה הנדסית#ביבליוגרפיה|(Zohdi, 2018)]].

עבור ארבעת המקרים באיור לעיל, יש לנו:

*   **מקרה 1**: אלמנט זה קביל, מאחר ש-$0 < J(\zeta_1, \zeta_2) < \infty$ בכל האלמנט. היעקוביאן קבוע במקרה זה.
*   **מקרה 2**: אלמנט זה אינו קביל, מאחר ש-$J(\zeta_1, \zeta_2) < 0$ בכל האלמנט. הבעיה המהותית היא שהצמתים ממוספרים באופן שגוי, מה שהופך את האלמנט ל-'הפוך'.
*   **מקרה 3**: אלמנט זה קביל, מאחר ש-$0 < J(\zeta_1, \zeta_2) < \infty$ בכל האלמנט. בעוד שהיעקוביאן אינו קבוע בכל תחום האלמנט, הוא חיובי וחסום.
*   **מקרה 4**: אלמנט זה אינו קביל, מאחר ש-$J(\zeta_1, \zeta_2) < 0$ באזורים מסוימים של האלמנט. למרות שהיעקוביאן חיובי בחלקים מסוימים של התחום, יעקוביאן שלילי בחלקים אחרים יכול לגרום לבעיות, כגון סינגולריות פוטנציאלית במטריצת הקשיחות.
*   עבור אלמנטים לינאריים, המדד המרכזי לאלמנט בעייתי הוא אי-קמירות (non-convexity) של האלמנט (גם אם הוא ממוספר נכון).

# צורה חלשה של משוואת פואסון
נפתח כעת הצורה החלשה של [[PDE1_007 משוואת לפלס#משוואות לפלס ופואסון|משוואת פואסון]]. בצורתו החזקה, למשל עבור בעיית חום:
$$\begin{aligned}
 & -\nabla \cdot (k\nabla T)+\alpha T=\dot{q} &  & \text{in }\Omega \\[1ex]
 & T(\mathbf{x})={T}_{s} &  & \mathbf{x}\in {\Gamma}_{u} \\[1ex]
  & k \frac{\partial T}{\partial\mathbf{n}} +h(\mathbf{x})T=q''_{s} &  & \mathbf{x}\in {\Gamma}_{t}
\end{aligned} $$

לשם גזירת הצורה החלשה, נכפיל את המשוואה הדיפרנציאלית בפונקציית מבחן שרירותית $\nu$ (חלקה מספיק ומתאפסת על שפת דיריכלה $\Gamma_u$, כלומר $\nu|_{\Gamma_u}=0$), ונבצע אינטגרציה על התחום $\Omega$:
$$ \int_{\Omega} \left(-\nabla \cdot (k\nabla T) + \alpha T - \dot{q}\right) \nu \ \mathrm{d}\Omega = 0 $$
$$ \Rightarrow \int_{\Omega} (-\nabla \cdot (k\nabla T))\nu \ \mathrm{d}\Omega + \int_{\Omega} \alpha T \nu \ \mathrm{d}\Omega = \int_{\Omega} \dot{q} \nu \ \mathrm{d}\Omega $$
ניישם אינטגרציה בחלקים (לפי משפט הדיברגנץ, או זהות גרין הראשונה) לאיבר הראשון. נשתמש בזהות $\nabla \cdot (\phi \mathbf{A}) = (\nabla \phi) \cdot \mathbf{A} + \phi (\nabla \cdot \mathbf{A})$. נבחר $\phi = \nu$ ו-$\mathbf{A} = k\nabla T$. אז $\nu \nabla \cdot (k\nabla T) = \nabla \cdot (\nu k \nabla T) - (\nabla\nu) \cdot (k\nabla T)$.
לכן, האיבר הראשון $\int_{\Omega} (-\nabla \cdot (k\nabla T))\nu \ \mathrm{d}\Omega$ הופך ל:
$$ \int_{\Omega} (k \nabla\nu \cdot \nabla T - \nabla \cdot (\nu k \nabla T)) \ \mathrm{d}\Omega = \int_{\Omega} k \nabla\nu \cdot \nabla T \ \mathrm{d}\Omega - \int_{\Omega} \nabla \cdot (\nu k \nabla T) \ \mathrm{d}\Omega $$
על האיבר השני באגף ימין נפעיל את משפט הדיברגנץ:
$$ \int_{\Omega} \nabla \cdot (\nu k \nabla T) \ \mathrm{d}\Omega = \int_{\partial\Omega} (\nu k \nabla T) \cdot \mathbf{n} \ \mathrm{d}A = \int_{\partial\Omega} \nu k \frac{\partial T}{\partial\mathbf{n}} \ \mathrm{d}A $$
כאשר $\mathbf{n}$ הוא וקטור הנורמל היוצא מהשפה $\partial\Omega$. הביטוי לאיבר הראשון בצורה האינטגרלית המקורית הוא:
$$ \int_{\Omega} (-\nabla \cdot (k\nabla T))\nu \ \mathrm{d}\Omega = \int_{\Omega} k \nabla\nu \cdot \nabla T \ \mathrm{d}\Omega - \int_{\partial\Omega} \nu k \frac{\partial T}{\partial\mathbf{n}} \ \mathrm{d}A $$
נציב זאת חזרה למשוואה האינטגרלית הכוללת:
$$ \int_{\Omega} k \nabla\nu \cdot \nabla T \ \mathrm{d}\Omega - \int_{\partial\Omega} \nu k \frac{\partial T}{\partial\mathbf{n}} \ \mathrm{d}A + \int_{\Omega} \alpha T \nu \ \mathrm{d}\Omega = \int_{\Omega} \dot{q} \nu \ \mathrm{d}\Omega $$
האינטגרל המשטחי על השפה $\partial\Omega = \Gamma_u \cup \Gamma_t$ מתפרק לשני חלקים. על $\Gamma_u$, פונקציית המבחן מתאפסת ($\nu=0$), ולכן האינטגרל על $\Gamma_u$ הוא אפס. נשארנו עם האינטגרל על $\Gamma_t$. נשתמש בתנאי השפה הנתון על $\Gamma_t$: $k \frac{\partial T}{\partial\mathbf{n}} = q''_{s} - h(\mathbf{x})T$.
לפיכך, האינטגרל המשטחי הוא:
$$ \int_{\partial\Omega} \nu k \frac{\partial T}{\partial\mathbf{n}} \ \mathrm{d}A = \int_{\Gamma_t} \nu (q''_{s} - h(\mathbf{x})T) \ \mathrm{d}A $$
הצבה חזרה וסידור מחדש מובילים לצורה החלשה של משוואת פואסון:

יש למצוא $T$ המקיימת $T=T_s$ על $\Gamma_u$, כך שלכל פונקציית מבחן קבילה $\nu$ (עם $\nu=0$ על $\Gamma_u$):
$$ \boxed{
\int_{\Omega} (k \nabla\nu \cdot \nabla T + \alpha \nu T) \mathrm{d}\Omega + \int_{\Gamma_t} h(\mathbf{x}) \nu T \mathrm{d}A = \int_{\Omega} \dot{q} \nu \mathrm{d}\Omega + \int_{\Gamma_t} q''_{s} \nu \mathrm{d}A
} $$

כעת נציג את קירוב האלמנטים הסופיים עבור הצורה החלשה של משוואת פואסון. נקרב את פונקציית הטמפרטורה $T$ ואת פונקציית המבחן $\nu$ באמצעות פונקציות צורה (או פונקציות בסיס) $\phi_i(\mathbf{x})$. יהיו $a_j$ הערכים הצומתיים של הטמפרטורה (דרגות החופש של הפתרון) ו-$b_i$ מקדמים שרירותיים עבור פונקציית המבחן.
הקירובים הם:
$$\begin{gathered}
 T(\mathbf{x}) \approx T^h(\mathbf{x}) = \sum_{j} \phi_j(\mathbf{x}) a_j  \\[1ex]
 \nu(\mathbf{x}) \approx \nu^h(\mathbf{x}) = \sum_{i} \phi_i(\mathbf{x}) b_i 
\end{gathered}$$
כאשר פונקציות הצורה $\phi_i$ נבחרות כך ש-$\nu^h = 0$ על שפת דיריכלה $\Gamma_u$. הנגזרות (גרדיאנטים) יהיו:
$$ \begin{gathered}
\nabla T^h(\mathbf{x}) = \sum_{j} \nabla\phi_j(\mathbf{x}) a_j  \\[1ex]
\nabla \nu^h(\mathbf{x}) = \sum_{i} \nabla\phi_i(\mathbf{x}) b_i 
\end{gathered}$$
נציב קירובים אלו לצורה החלשה. ניתן להוציא את הסכום על $j$ ואת המקדמים $a_j$ מהאינטגרלים המתאימים:
$$ \begin{aligned}
 & \sum_{i} b_i \left[ \sum_{j} a_j \left( \int_{\Omega} (k \nabla\phi_i \cdot \nabla\phi_j + \alpha \phi_i \phi_j) \mathrm{d}\Omega + \int_{\Gamma_t} h(\mathbf{x}) \phi_i \phi_j \mathrm{d}A \right) \right. \\[1ex]
 & \qquad \left. - \left( \int_{\Omega} \dot{q} \phi_i \mathrm{d}\Omega + \int_{\Gamma_t} q''_{s} \phi_i \mathrm{d}A \right) \right] = 0
\end{aligned} $$
מאחר שמשוואה זו צריכה להתקיים לכל בחירה שרירותית של מקדמי פונקציית המבחן $b_i$ (הכפופים לתנאי השפה ההומוגניים על $\Gamma_u$), הביטוי שבסוגריים המרובעים הגדולים חייב להתאפס לכל $i$. הדבר מוביל למערכת של משוואות אלגבריות לינאריות מהצורה:
$$ [\mathbf{K}]\{\mathbf{a}\} = \{\mathbf{R}\} $$
כאשר $\{\mathbf{a}\}$ הוא וקטור המקדמים הצומתיים הנעלמים של הטמפרטורה $a_j$. איברי המטריצה $[\mathbf{K}]$ (מטריצת הקשיחות או המוליכות) והווקטור $\{\mathbf{R}\}$ (וקטור העומס) ניתנים על ידי:
$$\boxed {
 \begin{gathered}
K_{ij} = \int_{\Omega} (k \nabla\phi_i \cdot \nabla\phi_j + \alpha \phi_i \phi_j) \mathrm{d}\Omega + \int_{\Gamma_t} h(\mathbf{x}) \phi_i \phi_j \mathrm{d}A \\[1ex]
R_i = \int_{\Omega} \dot{q} \phi_i \mathrm{d}\Omega + \int_{\Gamma_t} q''_{s} \phi_i \mathrm{d}A
\end{gathered} 
 }$$


# מיפוי אלמנט משולש לינארי כללי

בסעיף זה נפתח את הביטויים הדרושים למיפוי אלמנט משולש לינארי כללי מהמרחב הפיזיקלי אל אלמנט אב סטנדרטי, ונגזור את מטריצת הקשיחות האלמנטרית. גישה זו מפשטת את חישובי האינטגרלים ומאפשרת פיתוח שיטתי.

### אלמנט המסטר ופונקציות הצורה שלו
נבחר אלמנט אב משולש (master element) במערכת קואורדינטות מקומית $(\zeta_1, \zeta_2)$. קונפיגורציה נפוצה היא משולש ישר זווית עם צמתים בנקודות:
*   צומת מקומי 1: $P'_1 = (0,0)$
*   צומת מקומי 2: $P'_2 = (1,0)$
*   צומת מקומי 3: $P'_3 = (0,1)$

פונקציות הצורה הלינאריות $\hat{\phi}_k(\zeta_1,\zeta_2)$ על אלמנט המסטר הן:
$$ \begin{aligned}
\hat{\phi}_1(\zeta_1,\zeta_2) &= 1 - \zeta_1 - \zeta_2 \\
\hat{\phi}_2(\zeta_1,\zeta_2) &= \zeta_1 \\
\hat{\phi}_3(\zeta_1,\zeta_2) &= \zeta_2
\end{aligned} $$
לכל פונקציית צורה $\hat{\phi}_k$ יש ערך 1 בצומת המקומי $k$ ואפס בשני הצמתים האחרים. שטח אלמנט המסטר הוא $A_M = 1/2$.

הנגזרות של פונקציות הצורה לפי הקואורדינטות המקומיות הן:
$$ \begin{aligned}
\frac{\partial \hat{\phi}_1}{\partial \zeta_1} &= -1, & \frac{\partial \hat{\phi}_1}{\partial \zeta_2} &= -1 \\
\frac{\partial \hat{\phi}_2}{\partial \zeta_1} &= 1,  & \frac{\partial \hat{\phi}_2}{\partial \zeta_2} &= 0 \\
\frac{\partial \hat{\phi}_3}{\partial \zeta_1} &= 0,  & \frac{\partial \hat{\phi}_3}{\partial \zeta_2} &= 1
\end{aligned} $$
ניתן לרכז נגזרות אלו במטריצה $[\hat{\mathbf{B}}]$ בגודל $2 \times 3$:
$$ [\hat{\mathbf{B}}] = \begin{pmatrix}
\dfrac{\partial \hat{\phi}_1}{\partial \zeta_1} & \dfrac{\partial \hat{\phi}_2}{\partial \zeta_1} & \dfrac{\partial \hat{\phi}_3}{\partial \zeta_1} \\
\dfrac{\partial \hat{\phi}_1}{\partial \zeta_2} & \dfrac{\partial \hat{\phi}_2}{\partial \zeta_2} & \dfrac{\partial \hat{\phi}_3}{\partial \zeta_2}
\end{pmatrix} = \begin{pmatrix}
-1 & 1 & 0 \\
-1 & 0 & 1
\end{pmatrix} $$

### מיפוי איזופרמטרי וטרנספורמציית קואורדינטות
אלמנט משולש פיזיקלי $\Omega_e$ במרחב הגלובלי $(x,y)$ מוגדר על ידי קואורדינטות צמתיו: $P_1=(x_1,y_1)$, $P_2=(x_2,y_2)$, ו-$P_3=(x_3,y_3)$. אנו מניחים שהצומת הגלובלי $P_k$ מתאים לצומת המקומי $P'_k$.
המיפוי (טרנספורמציה) מקואורדינטות מקומיות $(\zeta_1,\zeta_2)$ לקואורדינטות גלובליות $(x,y)$ ניתן על ידי שימוש באותן פונקציות צורה (מיפוי איזופרמטרי):
$$ \begin{aligned}
x(\zeta_1,\zeta_2) &= \sum_{k=1}^{3} \hat{\phi}_k(\zeta_1,\zeta_2) x_k = \hat{\phi}_1 x_1 + \hat{\phi}_2 x_2 + \hat{\phi}_3 x_3 \\
y(\zeta_1,\zeta_2) &= \sum_{k=1}^{3} \hat{\phi}_k(\zeta_1,\zeta_2) y_k = \hat{\phi}_1 y_1 + \hat{\phi}_2 y_2 + \hat{\phi}_3 y_3
\end{aligned} $$
זוהי טרנספורמציה לינארית, הממפה קווים ישרים לקווים ישרים.

![[FEM1_006 שיטת אלמנטים סופיים בתלת-ממד 2025-05-28 13.29.22.excalidraw.svg]]
>טרנספורמציה לינארית של אלמנט פיזיקלי משולש לאלמנט מסטר משולש.

מטריצת היעקוביאן של הטרנספורמציה, $[\mathbf{J}]$, מקשרת דיפרנציאלים של קואורדינטות: $\mathrm{d}x = J_{11}\mathrm{d}\zeta_1 + J_{12}\mathrm{d}\zeta_2$ ו- $\mathrm{d}y = J_{21}\mathrm{d}\zeta_1 + J_{22}\mathrm{d}\zeta_2$. היא מוגדרת באופן הבא:
$$ [\mathbf{J} ]= \begin{pmatrix} \dfrac{\partial x}{\partial \zeta_1} & \dfrac{\partial x}{\partial \zeta_2} \\ \dfrac{\partial y}{\partial \zeta_1} & \dfrac{\partial y}{\partial \zeta_2} \end{pmatrix} = \begin{pmatrix} \sum_{k=1}^{3} \dfrac{\partial \hat{\phi}_k}{\partial \zeta_1} x_k & \sum_{k=1}^{3} \dfrac{\partial \hat{\phi}_k}{\partial \zeta_2} x_k \\ \sum_{k=1}^{3} \dfrac{\partial \hat{\phi}_k}{\partial \zeta_1} y_k & \sum_{k=1}^{3} \dfrac{\partial \hat{\phi}_k}{\partial \zeta_2} y_k \end{pmatrix} $$
עבור אלמנט משולש לינארי, רכיבי $\mathbf{J}$ הם קבועים. ניתן לרשום את מטריצת היעקוביאן גם באמצעות מטריצת הקואורדינטות הצומתיות $[\mathbf{X}]$ ומטריצת נגזרות פונקציות הצורה המקומיות $[\hat{\mathbf{B}}]$:
נגדיר את מטריצת הקואורדינטות הצומתיות של האלמנט הפיזיקלי $[\mathbf{X}]$ (בגודל $3 \times 2$):
$$ [\mathbf{X}] = \begin{pmatrix} x_1 & y_1 \\ x_2 & y_2 \\ x_3 & y_3 \end{pmatrix} $$
אז היעקוביאן ניתן לחישוב על ידי:
$$[\mathbf{J}] =  [\hat{\mathbf{B}}] [\mathbf{X}]$$

הדטרמיננטה של היעקוביאן, $\det(\mathbf{J})$, מייצגת את יחס השטחים בין האלמנט הפיזיקלי לאלמנט המסטר: $\mathrm{d}A = \det(\mathbf{J}) \mathrm{d}\zeta_1 \mathrm{d}\zeta_2$. עבור אלמנט משולש, $\det(\mathbf{J}) = 2 A_e$, כאשר $A_e$ הוא שטח האלמנט הפיזיקלי.

### טרנספורמציה של נגזרות
הנגזרות של פונקציית צורה (או כל פונקציה אחרת) לפי הקואורדינטות הגלובליות $(x,y)$ מתקבלות מהנגזרות לפי הקואורדינטות המקומיות $(\zeta_1,\zeta_2)$ באמצעות כלל השרשרת והיעקוביאן ההפוך $\mathbf{J}^{-1}$:
$$ \begin{pmatrix} \dfrac{\partial \phi_k}{\partial x} \\ \dfrac{\partial \phi_k}{\partial y} \end{pmatrix} = [\mathbf{J}]^{-1} \begin{pmatrix} \dfrac{\partial \hat{\phi}_k}{\partial \zeta_1} \\ \dfrac{\partial \hat{\phi}_k}{\partial \zeta_2} \end{pmatrix} $$
כאשר $\phi_k(x,y) = \hat{\phi}_k(\zeta_1(x,y), \zeta_2(x,y))$.
את מטריצת הנגזרות הגלובליות של כל פונקציות הצורה, $[\mathbf{B}]$ (בגודל $2 \times 3$), ניתן לרשום כך:
$$ [\mathbf{B}] = [\mathbf{J}]^{-1} [\hat{\mathbf{B}}] $$
כאשר כל עמודה $k$ ב-$[\mathbf{B}]$ היא $\begin{pmatrix} \partial \phi_k / \partial x \\ \partial \phi_k / \partial y \end{pmatrix}^T$.

### חישוב מטריצת קשיחות אלמנטרית
תרומת האלמנט $e$ למטריצת הקשיחות הגלובלית, לדוגמה עבור משוואת פואסון עם מקדם דיפוזיה $k(x,y)$, היא:
$$\begin{aligned}
 K_{ij}^e  & = \int_{\Omega_e} k(x,y) (\nabla\phi_i \cdot \nabla\phi_j) \mathrm{d}A  \\[1ex]
 & = \int_{\Omega_e} k(x,y) \left( \frac{\partial\phi_i}{\partial x}\frac{\partial\phi_j}{\partial x} + \frac{\partial\phi_i}{\partial y}\frac{\partial\phi_j}{\partial y} \right) \mathrm{d}A
\end{aligned} $$
בצורה מטריציונית עבור כל האלמנט:
$$ [\mathbf{K}]^e = \int_{\Omega_e} k(x,y) [\mathbf{B}]^T [\mathbf{B}] \mathrm{d}A $$
האינטגרל על האלמנט הפיזיקלי $\Omega_e$ מומר לאינטגרל על אלמנט המסטר $\Omega_M$ באמצעות הטרנספורמציה $\mathrm{d}A = |\det(\mathbf{J})| \mathrm{d}\zeta_1\mathrm{d}\zeta_2$:
$$ [\mathbf{K}]^e = \int_{\Omega_M} k(\zeta_1,\zeta_2) ([\mathbf{J}]^{-1}[\hat{\mathbf{B}}])^T ([\mathbf{J}]^{-1}[\hat{\mathbf{B}}]) |\det(\mathbf{J})| \mathrm{d}\zeta_1\mathrm{d}\zeta_2 $$
ניתן לפשט ביטוי זה ל:
$$ [\mathbf{K}]^e = \int_{\Omega_M} k(\zeta_1,\zeta_2) [\hat{\mathbf{B}}]^T (\mathbf{J}^{-1})^T \mathbf{J}^{-1} [\hat{\mathbf{B}}] |\det(\mathbf{J})| \mathrm{d}\zeta_1\mathrm{d}\zeta_2 $$
מכיוון שרכיבי $\mathbf{J}$ (ולכן גם $\mathbf{J}^{-1}$ ו-$\det(\mathbf{J})$) ורכיבי $[\hat{\mathbf{B}}]$ הם פונקציות של $(\zeta_1,\zeta_2)$ (אלא אם האלמנט הפיזיקלי הוא מלבן שצלעותיו מקבילות לצירים), האינטגרנד בדרך כלל אינו פולינום פשוט. לכן, יש לבצע את האינטגרציה באופן נומרי - אינטגרציית גאוס. עבור אלמנטים מרובעים ביליניאריים, לרוב משתמשים ב-$2 \times 2$ נקודות גאוס כדי לקבל תוצאות מדויקות אם $k$ קבוע או משתנה לינארית.

# מיפוי אלמנט מרובע ביליניארי כללי

בדומה לאלמנט המשולש, גם עבור אלמנטים מרובעים, נהוג להשתמש באלמנט מסטר סטנדרטי לטובת פיתוח פונקציות הצורה וביצוע אינטגרציה נומרית.

## אלמנט המסטר ופונקציות הצורה

אלמנט האב הסטנדרטי עבור אלמנט מרובע ביליניארי הוא ריבוע במערכת קואורדינטות מקומית $(\zeta_1, \zeta_2)$, כאשר $-1 \le \zeta_1 \le 1$ ו- $-1 \le \zeta_2 \le 1$. הצמתים המקומיים ממוספרים בדרך כלל נגד כיוון השעון, החל מהפינה השמאלית התחתונה:
*   צומת מקומי 1: $P'_1 = (-1, -1)$
*   צומת מקומי 2: $P'_2 = (1, -1)$
*   צומת מקומי 3: $P'_3 = (1, 1)$
*   צומת מקומי 4: $P'_4 = (-1, 1)$

פונקציות הצורה הביליניאריות $\hat{\phi}_k(\zeta_1,\zeta_2)$ עבור אלמנט זה הן:
$$ \begin{aligned}
\hat{\phi}_1(\zeta_1,\zeta_2) &= \frac{1}{4}(1-\zeta_1)(1-\zeta_2) \\
\hat{\phi}_2(\zeta_1,\zeta_2) &= \frac{1}{4}(1+\zeta_1)(1-\zeta_2) \\
\hat{\phi}_3(\zeta_1,\zeta_2) &= \frac{1}{4}(1+\zeta_1)(1+\zeta_2) \\
\hat{\phi}_4(\zeta_1,\zeta_2) &= \frac{1}{4}(1-\zeta_1)(1+\zeta_2)
\end{aligned} $$
לכל פונקציית צורה $\hat{\phi}_k$ יש ערך $1$ בצומת המקומי $k$ ואפס בשאר שלושת הצמתים. סכום פונקציות הצורה בכל נקודה בתוך האלמנט הוא אחד: $\sum_{k=1}^{4} \hat{\phi}_k(\zeta_1, \zeta_2) = 1$.

הנגזרות של פונקציות הצורה לפי הקואורדינטות המקומיות הן:
$$ \begin{aligned}
\frac{\partial \hat{\phi}_1}{\partial \zeta_1} &= -\frac{1}{4}(1-\zeta_2), & \frac{\partial \hat{\phi}_1}{\partial \zeta_2} &= -\frac{1}{4}(1-\zeta_1) \\
\frac{\partial \hat{\phi}_2}{\partial \zeta_1} &= \frac{1}{4}(1-\zeta_2),  & \frac{\partial \hat{\phi}_2}{\partial \zeta_2} &= -\frac{1}{4}(1+\zeta_1) \\
\frac{\partial \hat{\phi}_3}{\partial \zeta_1} &= \frac{1}{4}(1+\zeta_2),  & \frac{\partial \hat{\phi}_3}{\partial \zeta_2} &= \frac{1}{4}(1+\zeta_1) \\
\frac{\partial \hat{\phi}_4}{\partial \zeta_1} &= -\frac{1}{4}(1+\zeta_2), & \frac{\partial \hat{\phi}_4}{\partial \zeta_2} &= \frac{1}{4}(1-\zeta_1)
\end{aligned} $$
ניתן לרכז נגזרות אלו במטריצה $[\hat{\mathbf{B}}]$ בגודל $2 \times 4$:
$$ [\hat{\mathbf{B}}] = \frac{1}{4} \begin{pmatrix}
-(1-\zeta_2) & (1-\zeta_2) & (1+\zeta_2) & -(1+\zeta_2) \\
-(1-\zeta_1) & -(1+\zeta_1) & (1+\zeta_1) & (1-\zeta_1)
\end{pmatrix} $$

## מיפוי איזופרמטרי וטרנספורמציית קואורדינטות

המיפוי (טרנספורמציה) מקואורדינטות מקומיות $(\zeta_1,\zeta_2)$ לקואורדינטות גלובליות $(x,y)$ של אלמנט מרובע פיזיקלי כלשהו $P_1=(x_1,y_1), \dots, P_4=(x_4,y_4)$ ניתן על ידי שימוש באותן פונקציות צורה (מיפוי איזופרמטרי):
$$ \begin{aligned}
x(\zeta_1,\zeta_2) &= \sum_{k=1}^{4} \hat{\phi}_k(\zeta_1,\zeta_2) x_k \\
y(\zeta_1,\zeta_2) &= \sum_{k=1}^{4} \hat{\phi}_k(\zeta_1,\zeta_2) y_k
\end{aligned} $$
מטריצת היעקוביאן של הטרנספורמציה, $[\mathbf{J}]$, מוגדרת באופן זהה למקרה המשולש:
$$ [\mathbf{J}] = \begin{pmatrix} \dfrac{\partial x}{\partial \zeta_1} & \dfrac{\partial x}{\partial \zeta_2} \\ \dfrac{\partial y}{\partial \zeta_1} & \dfrac{\partial y}{\partial \zeta_2} \end{pmatrix} = \begin{pmatrix} \sum_{k=1}^{4} \dfrac{\partial \hat{\phi}_k}{\partial \zeta_1} x_k & \sum_{k=1}^{4} \dfrac{\partial \hat{\phi}_k}{\partial \zeta_2} x_k \\ \sum_{k=1}^{4} \dfrac{\partial \hat{\phi}_k}{\partial \zeta_1} y_k & \sum_{k=1}^{4} \dfrac{\partial \hat{\phi}_k}{\partial \zeta_2} y_k \end{pmatrix} $$
בניגוד לאלמנט משולש לינארי, עבור אלמנט מרובע ביליניארי, רכיבי מטריצת היעקוביאן $[\mathbf{J}]$ (ולכן גם הדטרמיננטה שלה, $\det(\mathbf{J})$) הם בדרך כלל פונקציות של $(\zeta_1,\zeta_2)$ ואינם קבועים על פני האלמנט.
נגדיר את מטריצת הקואורדינטות הצומתיות של האלמנט הפיזיקלי $[\mathbf{X}]$ (בגודל $4 \times 2$):
$$ [\mathbf{X}] = \begin{pmatrix} x_1 & y_1 \\ x_2 & y_2 \\ x_3 & y_3 \\ x_4 & y_4 \end{pmatrix} $$
אז היעקוביאן ניתן לחישוב על ידי (בניגוד לטקסט הקודם, כאן נשתמש בהגדרה סטנדרטית יותר):
$$ [\mathbf{J}]=[\hat{\mathbf{B}}][\mathbf{X}] $$
## טרנספורמציה של נגזרות
הנגזרות של פונקציית צורה $\phi_k(x,y)$ לפי הקואורדינטות הגלובליות $(x,y)$ מתקבלות מהנגזרות לפי הקואורדינטות המקומיות $\hat{\phi}_k(\zeta_1,\zeta_2)$ באמצעות כלל השרשרת:
$$ \begin{pmatrix} \dfrac{\partial \phi_k}{\partial x} \\ \dfrac{\partial \phi_k}{\partial y} \end{pmatrix} = [\mathbf{J}]^{-1} \begin{pmatrix} \dfrac{\partial \hat{\phi}_k}{\partial \zeta_1} \\ \dfrac{\partial \hat{\phi}_k}{\partial \zeta_2} \end{pmatrix} $$
את מטריצת הנגזרות הגלובליות של כל פונקציות הצורה, $[\mathbf{B}]$ (בגודל $2 \times 4$), ניתן לרשום כך:
$$ [\mathbf{B}] = [\mathbf{J}]^{-1} [\hat{\mathbf{B}}] $$

## חישוב מטריצת קשיחות אלמנטרית
תרומת האלמנט $e$ למטריצת הקשיחות הגלובלית, לדוגמה עבור משוואת פואסון עם מקדם דיפוזיה $k(x,y)$, היא:
$$ \begin{aligned}
K_{ij}^e  & = \int_{\Omega_e} k(x,y) (\nabla\phi_i \cdot \nabla\phi_j) \mathrm{d}A \\[1ex]
 &  = \int_{\Omega_e} k(x,y) \left( \frac{\partial\phi_i}{\partial x}\frac{\partial\phi_j}{\partial x} + \frac{\partial\phi_i}{\partial y}\frac{\partial\phi_j}{\partial y} \right) \mathrm{d}A
\end{aligned} $$
בצורה מטריציונית עבור כל האלמנט:
$$ [\mathbf{K}]^e = \int_{\Omega_e} k(x,y) [\mathbf{B}]^T [\mathbf{B}] \mathrm{d}A $$
האינטגרל על האלמנט הפיזיקלי $\Omega_e$ מומר לאינטגרל על אלמנט המסטר $\Omega_M$ באמצעות הטרנספורמציה $\mathrm{d}A = |\det(\mathbf{J})| \mathrm{d}\zeta_1 \mathrm{d}\zeta_2$:
$$ [\mathbf{K}]^e = \int_{-1}^{1}\int_{-1}^{1} k(\zeta_1,\zeta_2) ([\mathbf{J}]^{-1}[\hat{\mathbf{B}}])^T ([\mathbf{J}]^{-1}[\hat{\mathbf{B}}]) |\det(\mathbf{J})| \mathrm{d}\zeta_1\mathrm{d}\zeta_2 $$
ניתן לפשט ביטוי זה ל:
$$ [\mathbf{K}]^e = \int_{-1}^{1}\int_{-1}^{1} k(\zeta_1,\zeta_2) [\hat{\mathbf{B}}]^T (\mathbf{J}^{-1})^T \mathbf{J}^{-1} [\hat{\mathbf{B}}] |\det(\mathbf{J})| \mathrm{d}\zeta_1\mathrm{d}\zeta_2 $$
מכיוון שרכיבי $\mathbf{J}$ (ולכן גם $\mathbf{J}^{-1}$ ו-$\det(\mathbf{J})$) ורכיבי $[\hat{\mathbf{B}}]$ הם פונקציות של $(\zeta_1,\zeta_2)$ (אלא אם האלמנט הפיזיקלי הוא מלבן שצלעותיו מקבילות לצירים), האינטגרנד בדרך כלל אינו פולינום פשוט. לכן, יש לבצע את האינטגרציה באופן נומרי - אינטגרציית גאוס. עבור אלמנטים מרובעים ביליניאריים, לרוב משתמשים ב-$2 \times 2$ נקודות גאוס כדי לקבל תוצאות מדויקות אם $k$ קבוע או משתנה לינארית.

# הרכבת מטריצת הקשיחות הגלובלית

לאחר שפיתחנו את הצורה החלשה של המשוואה הדיפרנציאלית ואת הביטויים לאיברי מטריצת הקשיחות $K_{ij}$ והווקטור העומס $R_i$ הגלובליים, וראינו כיצד לחשב מטריצת קשיחות אלמנטרית $[\mathbf{K}]^e$ עבור אלמנט ספציפי, השלב הבא הוא הרכבת המערכת הגלובלית של המשוואות האלגבריות $[\mathbf{K}]\{\mathbf{a}\} = \{\mathbf{R}\}$.

האינטגרלים המגדירים את $K_{ij}$ ו-$R_i$ על פני כל התחום $\Omega$ (ועל שפת ניומן/רובין $\Gamma_t$) מחושבים כסכום של תרומות מכל האלמנטים הבודדים ברשת. כלומר:
$$ K_{ij} = \sum_{e=1}^{N_e} K_{ij}^{(e)}, \qquad R_i = \sum_{e=1}^{N_e} R_i^{(e)} $$
כאשר $N_e$ הוא מספר האלמנטים הכולל ברשת. $K_{ij}^{(e)}$ ו-$R_i^{(e)}$ מייצגים את התרומה של אלמנט $e$ לאיבר $K_{ij}$ במטריצה הגלובלית ולאיבר $R_i$ בווקטור העומס הגלובלי, בהתאמה. תרומות אלו נובעות מהאינטגרלים על תחום האלמנט $\Omega_e$ ועל חלק השפה $\Gamma_{t,e}$ השייך לאלמנט $e$:

$$\begin{gathered}
K_{ij}^{(e)} = \int_{\Omega_e} (k \nabla\phi_i \cdot \nabla\phi_j + \alpha \phi_i \phi_j) \mathrm{d}\Omega + \int_{\Gamma_{t,e}} h(\mathbf{x}) \phi_i \phi_j \mathrm{d}A \\[1ex]
R_i^{(e)} = \int_{\Omega_e} \dot{q} \phi_i \mathrm{d}\Omega + \int_{\Gamma_{t,e}} q''_{s} \phi_i \mathrm{d}A  
\end{gathered}$$

בביטויים אלו, $\phi_i$ ו-$\phi_j$ הן פונקציות הבסיס הגלובליות המשויכות לצמתים הגלובליים $i$ ו-$j$. כאשר מבצעים אינטגרציה על אלמנט $e$, פונקציות בסיס אלו הופכות לפונקציות הצורה המקומיות של האלמנט אם הצמתים $i$ ו-$j$ שייכים לאלמנט $e$; אחרת, תרומתן מאלמנט זה היא אפס.

תהליך ההרכבה מתבצע באופן שיטתי:
1.  **אתחול**: יוצרים מטריצת קשיחות גלובלית $[\mathbf{K}]$ ווקטור עומס גלובלי $\{\mathbf{R}\}$. מאתחלים את כל איבריהם לאפס.

2.  **לולאה על האלמנטים**: עוברים על כל אלמנט $e$ ברשת, מ-$e=1$ ועד $N_e$:
    - **חישוב מטריצות אלמנטריות**: עבור האלמנט הנוכחי $e$, מחשבים את מטריצת הקשיחות האלמנטרית $[\mathbf{K}]^e$ ואת וקטור העומס האלמנטרי $\{\mathbf{R}\}^e$. גודלה של $[\mathbf{K}]^e$ הוא $n_p \times n_p$, כאשר $n_p$ הוא מספר הצמתים באלמנט $e$ (למשל, $n_p=3$ לאלמנט משולש לינארי).

    - **זיהוי אינדקסים גלובליים**: באמצעות טבלת הקישוריות (כפי שתוארה בסעיף [[#יצירת רשת ופונקציות קישוריות|יצירת רשת ופונקציות קישוריות]]), מאתרים את מספרי הצמתים הגלובליים המתאימים לכל צומת מקומי של האלמנט $e$. נסמן את הפונקציה הממפה כ-$LM(e, \alpha)$, המחזירה את האינדקס הגלובלי של הצומת המקומי $\alpha$ באלמנט $e$.

    - **פיזור והוספה (Assembly)**: מוסיפים את איברי המטריצה והווקטור האלמנטריים למיקומים המתאימים במטריצה ובווקטור הגלובליים:
        עבור $\alpha$ מ-$1$ עד $n_p$, כאשר $i = LM(e, \alpha)$  (אינדקס שורה/רכיב גלובלי):
        $$(R)_i \leftarrow ({R})_i + (R^e)_\alpha$$
        עבור $\beta$ מ-$1$ עד $n_p$, כאשר $j = LM(e, \beta)$  (אינדקס עמודה גלובלי):
        $$({K})_{ij} \leftarrow ({K})_{ij} + (K^e)_{\alpha\beta}$$

3.  **המערכת הגלובלית**: לאחר שעוברים על כל האלמנטים, המטריצה $[\mathbf{K}]$ והווקטור $\{\mathbf{R}\}$ מכילים את התרומות מכל חלקי התחום והשפה הרלוונטית. המערכת $[\mathbf{K}]\{\mathbf{a}\} = \{\mathbf{R}\}$ מייצגת את הקירוב של הבעיה המקורית על פני כל הרשת.

יש לציין כי המטריצה הגלובלית $[\mathbf{K}]$ היא לרוב דלילה (sparse), כלומר רוב איבריה הם אפס. זאת מכיוון שכל צומת גלובלי קשור רק למספר קטן של צמתים אחרים (אלו החולקים איתו אלמנטים). ביישומים מעשיים, משתמשים בשיטות אחסון ופתרון יעילות המנצלות דלילות זו.

לאחר הרכבת המערכת הגלובלית, השלב הבא, לפני פתרון המערכת, הוא החלת תנאי שפה מסוג דיריכלה, אשר משנים את המטריצה $[\mathbf{K}]$ ואת הווקטור $\{\mathbf{R}\}$ כדי לכפות את הערכים הידועים של $\{\mathbf{a}\}$ בצמתים הרלוונטיים.

# תרגילים
## תרגיל 1
נתונה הבעיה הבאה ([[PDE1_007 משוואת לפלס#הקדמה|בעיית לפלס במלבן]]):
$$\begin{aligned}
 & \nabla ^{2}u=0 & & \text{in } \Omega=(0,1)\times(0,1) \\[1ex]
 & {u}(x,0)=1 &  & 0\leq  x\leq  1 \quad (\text{on } \Gamma_{12}) \\[1ex]
 & {u}_{y}(x,1)+u(x,1)=2 &  & 0\leq  x\leq  1 \quad (\text{on } \Gamma_{43}) \\[1ex]
& {u}_{x}(0,y)=0 &  & 0\leq  y\leq  1 \quad (\text{on } \Gamma_{14}) \\[1ex]
 & {u}_{x}(1,y)=0  &  & 0\leq  y\leq  1 \quad (\text{on } \Gamma_{23})
\end{aligned}$$

![[FEM1_006 שיטת אלמנטים סופיים בתלת-ממד 2025-05-27 17.54.59.excalidraw.svg]]
>תחום הבעיה הנתונה.

פתרו בעזרת שני אלמנטים משולשיים לינאריים.

**פתרון**:
הצורה החלשה הכללית למשוואת פואסון היא:
$$ [\mathbf{K}]\{\mathbf{a}\} = \{\mathbf{R}\} $$
כאשר איברי המטריצה והווקטור הם (לפי [[#צורה חלשה של משוואת פואסון]]):
$$\begin{gathered}
 K_{ij} = \int_{\Omega} (k \nabla\phi_i \cdot \nabla\phi_j + \alpha \phi_i \phi_j) \mathrm{d}\Omega + \int_{\Gamma_t} h(\mathbf{x}) \phi_i \phi_j \mathrm{d}S  \\[1ex]
 R_i = \int_{\Omega} \dot{q} \phi_i \mathrm{d}\Omega + \int_{\Gamma_t} q''_{s} \phi_i \mathrm{d}S
\end{gathered}$$

בבעיה שלנו, $\nabla^2 u = 0$, ולכן המקדם $k=1$ (או נספג בקואורדינטות), $\alpha=0$ ואין מקור פנימי $\dot{q}=0$.
תנאי השפה הם:
1.  על $\Gamma_{12}$: $u(x,0)=1$ (דיריכלה). מכאן $a_1=1, a_2=1$.
2.  על $\Gamma_{43}$: $u_y + u = 2$. זהו תנאי רובין מהצורה $k \frac{\partial u}{\partial n} + h u = q''_s$, כאשר $k=1$, כיוון הנורמל $n=y$, מקדם המעבר $h=1$ ושטף החום הנכפה $q''_s=2$.
3.  על $\Gamma_{14}$ ועל $\Gamma_{23}$: $u_x=0$. אלו תנאי נוימן הומוגניים ($q''_s=0$).

לכן, עבור הבעיה הספציפית שלנו:
$$ \begin{gathered}
K_{ij} = \int_{\Omega} (\nabla\phi_i \cdot \nabla\phi_j) \mathrm{d}\Omega + \int_{\Gamma_{43}} 1\cdot \phi_i \phi_j \mathrm{d}S \\[1ex]
R_i = 0 
\end{gathered} $$
הצמתים הגלובליים הם:
$$\begin{aligned}
 & 1: (0,0), &  & 2:(1,0) \\[1ex]
 & 3: (1,1), &  & 4:(0,1)
\end{aligned}$$
נחלק את התחום לשני אלמנטים משולשיים:
- אלמנט $e=1$: צמתים $\text{1-2-4}$
- אלמנט $e=2$: צמתים $\text{2-3-4}$

שטח כל אלמנט הוא $A_e = 0.5$.

![[FEM1_006 שיטת אלמנטים סופיים בתלת-ממד 2025-05-28 09.50.58.excalidraw.svg]]
>פירוק התחום לשני אלמנטים משולשיים.

עבור אלמנט משולש לינארי כללי עם צמתים $(x_1,y_1), (x_2,y_2), (x_3,y_3)$, מטריצת הקשיחות האלמנטרית $[\mathbf{K}]^e$ הנובעת מהאינטגרל הנפחי $\int_{\Omega_e} (\nabla\phi_i \cdot \nabla\phi_j) \mathrm{d}\Omega_e$ היא (לפי [[#מטריצת הקשיחות האלמנטרית]]):
$$ [\mathbf{K}]^e = \frac{1}{4A_e} \begin{pmatrix} b_1b_1+c_1c_1 & b_1b_2+c_1c_2 & b_1b_3+c_1c_3 \\ b_2b_1+c_2c_1 & b_2b_2+c_2c_2 & b_2b_3+c_2c_3 \\ b_3b_1+c_3c_1 & b_3b_2+c_3c_2 & b_3b_3+c_3c_3 \end{pmatrix} $$
כאשר $b_i = y_j - y_k$ ו- $c_i = x_k - x_j$ (בסדר מחזורי $i,j,k$).

**אלמנט 1 (צמתים גלובליים $\text{1-2-4}$)**:
הקואורדינטות מקומיות: $1_L=(0,0), 2_L=(1,0), 3_L=(0,1)$. $A_1=0.5$.
עבור צומת גלובלי 1 ($i=1_L$):
$$b_1 = 0-1 = -1,\qquad c_1 = 0-1 = -1$$
עבור צומת גלובלי 2 ($i=2_L$):
$$b_2 = 1-0 = 1,\qquad c_2 = 0-0 = 0$$
עבור צומת גלובלי 4 ($i=3_L$):
$$b_4 = 0-0 = 0,\qquad c_4 = 1-0 = 1$$
לכן:
$$\begin{aligned} \,[\mathbf{K}]^{e=1} &= \frac{1}{4(0.5)} \small\begin{pmatrix} (-1)^2+(-1)^2 & (-1)(1)+(-1)(0) & (-1)(0)+(-1)(1) \\ (1)(-1)+(0)(-1) & (1)^2+(0)^2 & (1)(0)+(0)(1) \\ (0)(-1)+(1)(-1) & (0)(1)+(1)(0) & (0)^2+(1)^2 \end{pmatrix} \\[3ex]&= \frac{1}{2} \begin{pmatrix} 2 & -1 & -1 \\ -1 & 1 & 0 \\ -1 & 0 & 1 \end{pmatrix} = \begin{pmatrix} 1 & -0.5 & -0.5 \\ -0.5 & 0.5 & 0 \\ -0.5 & 0 & 0.5 \end{pmatrix} \begin{matrix} \leftarrow 1 \\ \leftarrow 2 \\ \leftarrow 4 \end{matrix} \end{aligned}$$

**אלמנט 2 (צמתים גלובליים $\text{2-3-4}$)**:
הקואורדינטות מקומיות: $1_L=(1,0), 2_L=(1,1), 3_L=(0,1)$. $A_2=0.5$.
עבור צומת גלובלי 2 ($i=1_L$):
$$b_2 = 1-1 = 0,\qquad c_2 = 0-1 = -1$$
עבור צומת גלובלי 3 ($i=2_L$):
$$b_3 = 1-0 = 1,\qquad c_3 = 1-0 = 1$$
עבור צומת גלובלי 4 ($i=3_L$): 
$$b_4 = 0-1 = -1,\qquad c_4 = 1-1 = 0$$
לכן:
$$\begin{aligned}\, [\mathbf{K}]^{e=2} &= \frac{1}{2} \small\begin{pmatrix} (0)^2+(-1)^2 & (0)(1)+(-1)(1) & (0)(-1)+(-1)(0) \\ (1)(0)+(1)(-1) & (1)^2+(1)^2 & (1)(-1)+(1)(0) \\ (-1)(0)+(0)(-1) & (-1)(1)+(0)(0) & (-1)^2+(0)^2 \end{pmatrix} \\[3ex] &= \frac{1}{2} \begin{pmatrix} 1 & -1 & 0 \\ -1 & 2 & -1 \\ 0 & -1 & 1 \end{pmatrix} = \begin{pmatrix} 0.5 & -0.5 & 0 \\ -0.5 & 1 & -0.5 \\ 0 & -0.5 & 0.5 \end{pmatrix} \begin{matrix} \leftarrow 2 \\ \leftarrow 3 \\ \leftarrow 4 \end{matrix} \end{aligned}$$

**הרכבת מטריצת הקשיחות הגלובלית (אינטגרל נפחי)**:
$$\begin{aligned}
\, [\mathbf{K}]_{\text{domain}}  & = \begin{pmatrix} 1 & -0.5 & 0 & -0.5 \\ -0.5 & 0.5+0.5 & -0.5 & 0+0 \\ 0 & -0.5 & 1 & -0.5 \\ -0.5 & 0+0 & -0.5 & 0.5+0.5 \end{pmatrix} \\[3ex]
 &  = \begin{pmatrix} 1 & -0.5 & 0 & -0.5 \\ -0.5 & 1 & -0.5 & 0 \\ 0 & -0.5 & 1 & -0.5 \\ -0.5 & 0 & -0.5 & 1 \end{pmatrix}
\end{aligned} $$

**תרומת תנאי רובין (אינטגרל שפה על $\Gamma_{43}$)**:
התרומה היא $\int_{\Gamma_{43}} \phi_i \phi_j \mathrm{d}S$. הקטע $\Gamma_{43}$ הוא בין צומת $4$ לצומת $3$. אורך הקטע $L=1$. פונקציות הצורה הלינאריות על קטע זה הן $\phi_4(s) = 1-s/L$ ו- $\phi_3(s)=s/L$. מטריצת התרומה היא:
$$ \begin{aligned}\,
[\mathbf{K}]_{\text{Robin}, \Gamma_{43}}  & = \frac{L}{6} \begin{pmatrix} 2 & 1 \\ 1 & 2 \end{pmatrix}  \\[2ex]
 & = \frac{1}{6} \begin{pmatrix} 2 & 1 \\ 1 & 2 \end{pmatrix} \begin{matrix} \end{matrix} \\[2ex]
 &  = \begin{pmatrix} 1/3 & 1/6 \\ 1/6 & 1/3 \end{pmatrix} \begin{matrix} \leftarrow 4 \\ \leftarrow 3 \end{matrix}
\end{aligned} $$
(שימו לב לסדר השורות והעמודות בהתאם לצמתים הגלובליים 3 ו-4):
$$ [\mathbf{K}]_{\text{Robin}, \Gamma_{43}}^{\text{global}} = \begin{pmatrix} 0 & 0 & 0 & 0 \\ 0 & 0 & 0 & 0 \\ 0 & 0 & 1/3 & 1/6 \\ 0 & 0 & 1/6 & 1/3 \end{pmatrix} $$

מטריצת הקשיחות הגלובלית הכוללת:
$$\begin{aligned}\, [\mathbf{K}] &= [\mathbf{K}]_{\text{domain}} + [\mathbf{K}]_{\text{Robin}, \Gamma_{43}}^{\text{global}} \\[3ex] &= \begin{pmatrix} 1 & -0.5 & 0 & -0.5 \\ -0.5 & 1 & -0.5 & 0 \\ 0 & -0.5 & 1+1/3 & -0.5+1/6 \\ -0.5 & 0 & -0.5+1/6 & 1+1/3 \end{pmatrix} \\[3ex]
 &  = \begin{pmatrix} 1 & -0.5 & 0 & -0.5 \\ -0.5 & 1 & -0.5 & 0 \\ 0 & -0.5 & 4/3 & -1/3 \\ -0.5 & 0 & -1/3 & 4/3 \end{pmatrix} \end{aligned}$$

וקטור העומס הגלובלי $\{\mathbf{R}\}$ כולל את התרומה מתנאי הרובין על $\Gamma_{43}$. מכיוון ש-$\dot{q}=0$, התרומה היחידה היא מהאינטגרל השפתי $\int_{\Gamma_t} q''_s \phi_i \mathrm{d}S$.
על $\Gamma_{43}$ (בין צמתים 3 ו-4), $q''_s=2$. על $\Gamma_{14}$ ו- $\Gamma_{23}$ (תנאי נוימן הומוגניים), $q''_s=0$.
האינטגרל $\int_{\Gamma_{L}} \phi_i \mathrm{d}S$ עבור פונקציית בסיס לינארית $\phi_i$ על קטע באורך $L$ הוא $L/2$ עבור כל אחד משני צמתי הקטע.
הקטע $\Gamma_{43}$ הוא באורך $L=1$. לכן:
$$ R_3 = \int_{\Gamma_{43}} 2 \cdot \phi_3 \mathrm{d}S = 2 \cdot (L/2) = L = 1 $$
$$ R_4 = \int_{\Gamma_{43}} 2 \cdot \phi_4 \mathrm{d}S = 2 \cdot (L/2) = L = 1 $$
כל שאר איברי וקטור העומס הם אפס ($R_1=0, R_2=0$).
לכן, $\{\mathbf{R}\} = \begin{pmatrix} 0 & 0 & 1 & 1 \end{pmatrix}^T$.

**החלת תנאי שפה דיריכלה**:
נתון $u(x,0)=1$, ולכן $a_1=1$ ו-$a_2=1$. נותר למצוא את $a_3, a_4$.
מערכת המשוואות הגלובלית היא $[\mathbf{K}]\{\mathbf{a}\} = \{\mathbf{R}\}$. ניקח את המשוואות השלישית והרביעית:

$$\begin{align}
 & \mathrm{III}: &  &\begin{gathered}
 K_{31}a_1 + K_{32}a_2 + K_{33}a_3 + K_{34}a_4 = R_3   \\[1ex]
0 \cdot (1) + (-0.5) \cdot (1) + (4/3)a_3 + (-1/3)a_4 = 1 \\[1ex]
-0.5 + (4/3)a_3 - (1/3)a_4 = 1 \\[1ex]
(4/3)a_3 - (1/3)a_4 = 1.5
\end{gathered} \\[3ex]
 & \mathrm{IV}: &  & \begin{gathered}
K_{41}a_1 + K_{42}a_2 + K_{43}a_3 + K_{44}a_4 = R_4   \\[1ex]
(-0.5) \cdot (1) + 0 \cdot (1) + (-1/3)a_3 + (4/3)a_4 = 1 \\[1ex]
-0.5 - (1/3)a_3 + (4/3)a_4 = 1 \\[1ex]
-(1/3)a_3 + (4/3)a_4 = 1.5
\end{gathered}
\end{align}$$

הפתרון עבור $a_3, a_4$ הוא ${a}_{3}=1.5$ ו-${a}_{4}=1.5$. לכן הפתרון הסופי:
$$\boxed {
\{ \mathbf{a} \}=\begin{pmatrix}
1 \\ 1 \\ 1.5 \\ 1.5
\end{pmatrix}^{T}
 }$$

## תרגיל 2

נתונה הבעיה הבאה:
$$\begin{aligned}
 & \nabla ^{2}T=0 & & \text{in } \Omega\\[1ex]
 & T=2x-3 &  & \text{on}\, {\Gamma}_{u}  \\[1ex]
 & \dfrac{\mathrm{d}T}{\mathrm{d}\hat{\mathbf{n}}}+\sqrt{ 2 }T=2\sqrt{ 2 }(1-2x) &  & \text{on}\,{\Gamma}_{t}
\end{aligned}$$

כאשר:
$$\begin{aligned}
 & \Omega: &  & \{ -y\leq  x\leq  y\mid x \in [0,1] \} \cup \{ y-2\leq  x\leq  -y+2\mid x \in [1,2] \} \\[1ex]
 & {\Gamma}_{u}: &  & \{ x=y-2\mid x \in [1,2] \}\cup \{ x=-y+2\mid x \in [1,2] \} \\[1ex]
 & {\Gamma}_{t}: &  & \{ x=y\mid x \in [0,1] \}\cup \{ x=y\mid x \in [0,1] \}
\end{aligned}$$


![[FEM1_006 שיטת אלמנטים סופיים בתלת-ממד 2025-05-28 15.50.05.excalidraw.svg]]
>תחום הבעיה הנתונה.


פתרו בעזרת שני אלמנטים משולשיים לינאריים.

**פתרון**:
הצורה החלשה הכללית למשוואת פואסון היא:
$$ [\mathbf{K}]\{\mathbf{a}\} = \{\mathbf{R}\} $$
כאשר איברי המטריצה והווקטור הם:
$$\begin{gathered}
 K_{ij} = \int_{\Omega} (k \nabla\phi_i \cdot \nabla\phi_j + \alpha \phi_i \phi_j) \mathrm{d}\Omega + \int_{\Gamma_t} h(\mathbf{x}) \phi_i \phi_j \mathrm{d}S  \\[1ex]
 R_i = \int_{\Omega} \dot{q} \phi_i \mathrm{d}\Omega + \int_{\Gamma_t} q''_{s} \phi_i \mathrm{d}S
\end{gathered}$$
בבעיה הנתונה, $\nabla^2 T = 0$, ולכן מקדם המוליכות $k=1$, $\alpha=0$ (אין איבר תלוי ב-$T$ במשוואה הדיפרנציאלית עצמה), ואין מקור חימום פנימי $\dot{q}=0$.
תנאי השפה הם:
1.  על $\Gamma_u$: $T=2x-3$ (תנאי דיריכלה).
2.  על $\Gamma_t$: $\dfrac{\mathrm{d}T}{\mathrm{d}\hat{\mathbf{n}}}+\sqrt{ 2 }T=2\sqrt{ 2 }(1-2x)$. זהו תנאי רובין מהצורה $k \frac{\partial T}{\partial n} + h T = q''_s$. מאחר ו-$k=1$, אז $h(\mathbf{x}) = \sqrt{2}$ ו-$q''_s(\mathbf{x}) = 2\sqrt{2}(1-2x)$.

לכן, עבור הבעיה הספציפית שלנו:
$$ \begin{gathered}
K_{ij} = \int_{\Omega} (\nabla\phi_i \cdot \nabla\phi_j) \mathrm{d}\Omega + \int_{\Gamma_t} \sqrt{2} \cdot \phi_i \phi_j \mathrm{d}S \\[1ex]
R_i = \int_{\Gamma_t} 2\sqrt{2}(1-2x) \phi_i \mathrm{d}S
\end{gathered} $$

הצמתים הגלובליים הם (נסמן אותם $P_1, P_2, P_3, P_4$ בהתאמה לאינדקסים בוקטור הנעלמים $\{a\}$):
$$\begin{aligned}
 & P_1: (0,0) & & P_2: (1,-1) \\[1ex]
 & P_3: (2,0) & & P_4: (1,1)
\end{aligned}$$
נחלק את התחום לשני אלמנטים משולשיים:
*   אלמנט $e=1$: צמתים גלובליים $\text{1-2-3}$.
*   אלמנט $e=2$: צמתים גלובליים $\text{3-4-1}$.

שטח כל אלמנט הוא $A_e = 1$.

![[FEM1_006 שיטת אלמנטים סופיים בתלת-ממד 2025-05-28 16.14.14.excalidraw.svg]]
>פירוק התחום לשני אלמנטים משולשיים.

עבור אלמנט משולש לינארי כללי, מטריצת הקשיחות האלמנטרית הנובעת מהאינטגרל הנפחי היא:
$$ [\mathbf{K}]^e_{\text{domain}} = \frac{1}{4A_e} \begin{pmatrix} b_1b_1+c_1c_1 & b_1b_2+c_1c_2 & b_1b_3+c_1c_3 \\ b_2b_1+c_2c_1 & b_2b_2+c_2c_2 & b_2b_3+c_2c_3 \\ b_3b_1+c_3c_1 & b_3b_2+c_3c_2 & b_3b_3+c_3c_3 \end{pmatrix} $$
כאשר $b_i = y_j - y_k$ ו- $c_i = x_k - x_j$ (בסדר מחזורי $i,j,k$).

**אלמנט $1$ (צמתים גלובליים $\text{1-2-3}$)**:
הקואורדינטות של הצמתים הגלובליים המרכיבים את אלמנט $1$ הן: $P_1=(0,0), P_2=(1,-1), P_3=(2,0)$. שטח האלמנט $A_1=1$.
עבור צומת גלובלי $P_1$ ($i=1_{L}$):
$$b_{1} = y_2-y_3 = -1-0 = -1, \qquad c_{1} = x_3-x_2 = 2-1 = 1$$
עבור צומת גלובלי $P_2$ ($i=2_{L}$):
$$b_{2} = y_3-y_1 = 0-0 = 0, \qquad c_{2} = x_1-x_3 = 0-2 = -2$$
עבור צומת גלובלי $P_3$ ($i=3_{L}$):
$$b_{3} = y_1-y_2 = 0-(-1) = 1, \qquad c_{3} = x_2-x_1 = 1-0 = 1$$
מטריצת הקשיחות של אלמנט $1$ מהאינטגרל הנפחי: 
$$\begin{aligned} \,[\mathbf{K}]^{e=1}_{\text{domain}} &= \frac{1}{4(1)} \small\begin{pmatrix} (-1)^2+(1)^2 & (-1)(0)+(1)(-2) & (-1)(1)+(1)(1) \\ (0)(-1)+(-2)(1) & (0)^2+(-2)^2 & (0)(1)+(-2)(1) \\ (1)(-1)+(1)(1) & (1)(0)+(1)(-2) & (1)^2+(1)^2 \end{pmatrix} \\[3ex]&= \frac{1}{4} \begin{pmatrix} 2 & -2 & 0 \\ -2 & 4 & -2 \\ 0 & -2 & 2 \end{pmatrix} = \begin{pmatrix} 0.5 & -0.5 & 0 \\ -0.5 & 1 & -0.5 \\ 0 & -0.5 & 0.5 \end{pmatrix} \begin{matrix} \leftarrow 1 \\ \leftarrow 2 \\ \leftarrow 3 \end{matrix} \end{aligned}$$

**אלמנט $2$ (צמתים גלובליים $\text{3-4-1}$)**:
הקואורדינטות של הצמתים הגלובליים המרכיבים את אלמנט $2$ הן: $P_3=(2,0), P_4=(1,1), P_1=(0,0)$. שטח האלמנט $A_2=1$.
עבור צומת גלובלי $P_3$ ($i=1_{L}$):
$$b_{3}^{} = y_4-y_1 = 1-0 = 1, \qquad c_{3}^{} = x_1-x_4 = 0-1 = -1$$
עבור צומת גלובלי $P_4$ ($i=2_{L}$):
$$b_{4}^{} = y_1-y_3 = 0-0 = 0, \qquad c_{4}^{} = x_3-x_1 = 2-0 = 2$$
עבור צומת גלובלי $P_1$ ($i=3_{L}$):
$$b_{1}^{} = y_3-y_4 = 0-1 = -1, \qquad c_{1}^{} = x_4-x_3 = 1-2 = -1$$
מטריצת הקשיחות של אלמנט $2$ מהאינטגרל הנפחי:
$$\begin{aligned} \,[\mathbf{K}]^{e=2}_{\text{domain}} &= \frac{1}{4(1)} \small\begin{pmatrix} (1)^2+(-1)^2 & (1)(0)+(-1)(2) & (1)(-1)+(-1)(-1) \\ (0)(1)+(2)(-1) & (0)^2+(2)^2 & (0)(-1)+(2)(-1) \\ (-1)(1)+(-1)(-1) & (-1)(0)+(-1)(2) & (-1)^2+(-1)^2 \end{pmatrix} \\[3ex]&= \frac{1}{4} \begin{pmatrix} 2 & -2 & 0 \\ -2 & 4 & -2 \\ 0 & -2 & 2 \end{pmatrix} = \begin{pmatrix} 0.5 & -0.5 & 0 \\ -0.5 & 1 & -0.5 \\ 0 & -0.5 & 0.5 \end{pmatrix} \begin{matrix} \leftarrow 3 \\ \leftarrow 4 \\ \leftarrow 1 \end{matrix} \end{aligned}$$

**הרכבת מטריצת הקשיחות הגלובלית (אינטגרל נפחי)**:
$$\begin{aligned}\,
[\mathbf{K}]_{\text{domain}}  & = \begin{pmatrix} 0.5+0.5 & -0.5 & 0+0 & -0.5 \\ -0.5 & 1 & -0.5 & 0 \\ 0+0 & -0.5 & 0.5+0.5 & -0.5 \\ -0.5 & 0 & -0.5 & 1 \end{pmatrix}  \\[3ex]
 & = \begin{pmatrix} 1 & -0.5 & 0 & -0.5 \\ -0.5 & 1 & -0.5 & 0 \\ 0 & -0.5 & 1 & -0.5 \\ -0.5 & 0 & -0.5 & 1 \end{pmatrix}
\end{aligned}$$

**תרומת תנאי רובין (אינטגרל שפה על $\Gamma_t$) למטריצת הקשיחות**:
תנאי השפה על $\Gamma_t$ הוא $\frac{\mathrm{d}T}{\mathrm{d}\hat{\mathbf{n}}}+\sqrt{ 2 }T=2\sqrt{ 2 }(1-2x)$, לכן $h=\sqrt{2}$.
השפה $\Gamma_t$ מורכבת מהקטעים $P_1P_2$ ו-$P_1P_4$.

אורך קטע $P_1P_2$: $L_{12} = \sqrt{(1-0)^2+(-1-0)^2} = \sqrt{2}$. קטע זה שייך לאלמנט 1.
תרומת $P_1P_2$ למטריצת הקשיחות:
$$ [\mathbf{K}]_{\text{Robin}}^{(P_1P_2)} = \frac{h L_{12}}{6}\begin{pmatrix} 2 & 1 \\ 1 & 2 \end{pmatrix} = \frac{\sqrt{2}\sqrt{2}}{6}\begin{pmatrix} 2 & 1 \\ 1 & 2 \end{pmatrix} = \frac{1}{3}\begin{pmatrix} 2 & 1 \\ 1 & 2 \end{pmatrix} \begin{matrix} \leftarrow 1 \\ \leftarrow 2 \end{matrix} $$

אורך קטע $P_1P_4$: $L_{14} = \sqrt{(1-0)^2+(1-0)^2} = \sqrt{2}$. קטע זה שייך לאלמנט 2.
תרומת $P_1P_4$ למטריצת הקשיחות:
$$ [\mathbf{K}]_{\text{Robin}}^{(P_1P_4)} = \frac{h L_{14}}{6}\begin{pmatrix} 2 & 1 \\ 1 & 2 \end{pmatrix} = \frac{\sqrt{2}\sqrt{2}}{6}\begin{pmatrix} 2 & 1 \\ 1 & 2 \end{pmatrix} = \frac{1}{3}\begin{pmatrix} 2 & 1 \\ 1 & 2 \end{pmatrix} \begin{matrix} \leftarrow 1 \\ \leftarrow 4 \end{matrix} $$

סך תרומת תנאי רובין למטריצת הקשיחות הגלובלית:
$$ [\mathbf{K}]_{\text{Robin}} = \begin{pmatrix} 2/3+2/3 & 1/3 & 0 & 1/3 \\ 1/3 & 2/3 & 0 & 0 \\ 0 & 0 & 0 & 0 \\ 1/3 & 0 & 0 & 2/3 \end{pmatrix} = \begin{pmatrix} 4/3 & 1/3 & 0 & 1/3 \\ 1/3 & 2/3 & 0 & 0 \\ 0 & 0 & 0 & 0 \\ 1/3 & 0 & 0 & 2/3 \end{pmatrix} $$

מטריצת הקשיחות הגלובלית הכוללת: $[\mathbf{K}] = [\mathbf{K}]_{\text{domain}} + [\mathbf{K}]_{\text{Robin}}$
$$
\begin{aligned}
\,[\mathbf{K}]  & = \begin{pmatrix} 1+4/3 & -0.5+1/3 & 0 & -0.5+1/3 \\ -0.5+1/3 & 1+2/3 & -0.5 & 0 \\ 0 & -0.5 & 1 & -0.5 \\ -0.5+1/3 & 0 & -0.5 & 1+2/3 \end{pmatrix}  \\[3ex]
 & = \begin{pmatrix} 7/3 & -1/6 & 0 & -1/6 \\ -1/6 & 5/3 & -0.5 & 0 \\ 0 & -0.5 & 1 & -0.5 \\ -1/6 & 0 & -0.5 & 5/3 \end{pmatrix}
\end{aligned}
 $$

**וקטור העומס הגלובלי $\{\mathbf{R}\}$**:
$R_i = \int_{\Gamma_t} q''_s \phi_i \mathrm{d}S$, כאשר $q''_s(\mathbf{x}) = 2\sqrt{2}(1-2x)$.
האינטגרל $\int_L f(s) \phi_k(s) \mathrm{d}s$ כאשר $f(s)$ לינארי $f(s) = f_A \phi_A(s) + f_B \phi_B(s)$ לאורך קטע $AB$ ניתן לחישוב ע"י $\frac{L}{6}(2f_A+f_B)$ עבור $\phi_A$ ו-$\frac{L}{6}(f_A+2f_B)$ עבור $\phi_B$.

על קטע $P_1P_2$ ($L_{12}=\sqrt{2}$), $P_1=(0,0), P_2=(1,-1)$:
$$\begin{aligned}
q''_s(P_1) &= 2\sqrt{2}(1-2(0)) = 2\sqrt{2} \\
q''_s(P_2) &= 2\sqrt{2}(1-2(1)) = -2\sqrt{2}
\end{aligned}$$
תרומות לוקטור העומס מקטע $P_1P_2$:
$$\begin{aligned}
R_1^{(P_1P_2)} &= \frac{L_{12}}{6}(2q''_s(P_1) + q''_s(P_2))  \\[1ex]
 & = \frac{\sqrt{2}}{6}(2(2\sqrt{2}) + (-2\sqrt{2}))  \\[1ex]
 & = \frac{\sqrt{2}}{6}(2\sqrt{2})  \\[1ex]
 &  = 2/3 \\[3ex]
R_2^{(P_1P_2)} &= \frac{L_{12}}{6}(q''_s(P_1) + 2q''_s(P_2))  \\[1ex]
 & = \frac{\sqrt{2}}{6}(2\sqrt{2} + 2(-2\sqrt{2}))  \\[1ex]
 & = \frac{\sqrt{2}}{6}(-2\sqrt{2})  \\[1ex]
 & = -2/3
\end{aligned}$$

על קטע $P_1P_4$ ($L_{14}=\sqrt{2}$), $P_1=(0,0), P_4=(1,1)$:
$$\begin{aligned}
q''_s(P_1) &= 2\sqrt{2}(1-2(0)) = 2\sqrt{2} \\
q''_s(P_4) &= 2\sqrt{2}(1-2(1)) = -2\sqrt{2}
\end{aligned}$$
תרומות לוקטור העומס מקטע $P_1P_4$:
$$\begin{aligned}
R_1^{(P_1P_4)} &= \frac{L_{14}}{6}(2q''_s(P_1) + q''_s(P_4))  \\[1ex]
 & = \frac{\sqrt{2}}{6}(2(2\sqrt{2}) + (-2\sqrt{2}))  \\[1ex]
 & = \frac{\sqrt{2}}{6}(2\sqrt{2})  \\[1ex]
 &  = 2/3 \\[3ex]
R_4^{(P_1P_4)} &= \frac{L_{14}}{6}(q''_s(P_1) + 2q''_s(P_4))  \\[1ex]
 & = \frac{\sqrt{2}}{6}(2\sqrt{2} + 2(-2\sqrt{2}))  \\[1ex]
 & = \frac{\sqrt{2}}{6}(-2\sqrt{2})  \\[1ex]
 &  = -2/3
\end{aligned}$$

סך וקטור העומס הגלובלי:
$$ \{\mathbf{R}\} = \begin{pmatrix} R_1^{(P_1P_2)} + R_1^{(P_1P_4)} \\ R_2^{(P_1P_2)} \\ 0 \\ R_4^{(P_1P_4)} \end{pmatrix} = \begin{pmatrix} 2/3 + 2/3 \\ -2/3 \\ 0 \\ -2/3 \end{pmatrix} = \begin{pmatrix} 4/3 \\ -2/3 \\ 0 \\ -2/3 \end{pmatrix} $$

**החלת תנאי שפה דיריכלה**:
על $\Gamma_u$, $T=2x - 3$:
$$\begin{aligned}
a_2 &= T(P_2) = T(1,-1) = 2\cdot 1-3 = -1 \\[1ex]
a_3 &= T(P_3) = T(2,0) = 2\cdot 2-3 = 1 \\[1ex]
a_4 &= T(P_4) = T(1,1) = 2\cdot 1-3 = -1
\end{aligned}$$
נותר למצוא את $a_1$. נשתמש במשוואה הראשונה ממערכת המשוואות הגלובלית $[\mathbf{K}]\{\mathbf{a}\} = \{\mathbf{R}\}$:
$$\begin{gathered}
K_{11}a_1 + K_{12}a_2 + K_{13}a_3 + K_{14}a_4 = R_1 \\
\left( \frac{7}{3} \right)a_1 + \left( -\frac{1}{6} \right)a_2 + 0\cdot a_3 + \left( -\frac{1}{6} \right)a_4 = \frac{4}{3} \\
\left( \frac{7}{3} \right)a_1 + \frac{1}{6} + \frac{1}{6} = \frac{4}{3} \\
a_1 = \frac{3}{7}
\end{gathered}$$
לכן הפתרון הסופי:
$$\boxed {
\{ \mathbf{a} \}=\begin{pmatrix}
3/7 \\ -1 \\ 1 \\ -1
\end{pmatrix}^{T}
 }$$

## תרגיל 3
נתונה אותה בעיה כמו ב[[#תרגיל 2]]י:
$$\begin{aligned}
 & \nabla ^{2}T=0 & & \text{in } \Omega\\[1ex]
 & T=2x-3 &  & \text{on}\, {\Gamma}_{u}  \\[1ex]
 & \dfrac{\mathrm{d}T}{\mathrm{d}\hat{\mathbf{n}}}+\sqrt{ 2 }T=2\sqrt{ 2 }(1-2x) &  & \text{on}\,{\Gamma}_{t}
\end{aligned}$$
כאשר התחום הוא יהלום עם צמתים ב-$(0,0), (1,-1), (2,0), (1,1)$.

פתרו בעזרת אלמנט ביליניארי יחיד.

**פתרון**:
נשתמש באלמנט ביליניארי יחיד המכסה את כל התחום. הצמתים הגלובליים הם:
$$\begin{aligned}
 & P_1: (0,0) & & P_2: (1,-1) \\[1ex]
 & P_3: (2,0) & & P_4: (1,1)
\end{aligned}$$

**מיפוי לאלמנט הייחוס**:
עבור אלמנט ביליניארי, נמפה את התחום לריבוע ייחוס $(\zeta_1, \zeta_2) \in [-1,1] \times [-1,1]$ עם פונקציות הצורה:
$$\begin{aligned}
\hat{\phi}_1(\zeta_1,\zeta_2) &= \frac{1}{4}(1-\zeta_1)(1-\zeta_2) \\[1ex]
\hat{\phi}_2(\zeta_1,\zeta_2) &= \frac{1}{4}(1+\zeta_1)(1-\zeta_2) \\[1ex]
\hat{\phi}_3(\zeta_1,\zeta_2) &= \frac{1}{4}(1+\zeta_1)(1+\zeta_2) \\[1ex]
\hat{\phi}_4(\zeta_1,\zeta_2) &= \frac{1}{4}(1-\zeta_1)(1+\zeta_2)
\end{aligned}$$

נסיק מכך כי:
$$\begin{aligned}
\,[\hat{\mathbf{B}}] & =\dfrac{ \partial \boldsymbol{\phi} }{ \partial \boldsymbol{\zeta} } =\dfrac{1}{4}\begin{pmatrix}
-(1-{\zeta}_{2}) & 1-{\zeta}_{2} & 1+{\zeta}_{2} & -(1+{\zeta}_{2}) \\
-(1-{\zeta}_{1}) & -(1+{\zeta}_{1}) & 1+{\zeta}_{1} & 1-{\zeta}_{1}
\end{pmatrix}
\end{aligned}$$
בנוסף:
$$[\mathbf{X}]=\begin{pmatrix}
0 & 0 \\
1 & -1 \\
2 & 0 \\
1 & 1
\end{pmatrix}$$
לכן מטריצת היעקוביאן:
$$\begin{aligned}
\,[\mathbf{J}] & =[\hat{\mathbf{B}}][\mathbf{X}] \\[1ex]
 & = \dfrac{1}{4}\small\begin{pmatrix}
-(1-{\zeta}_{2}) & 1-{\zeta}_{2} & 1+{\zeta}_{2} & -(1+{\zeta}_{2}) \\
-(1-{\zeta}_{1}) & -(1+{\zeta}_{1}) & 1+{\zeta}_{1} & 1-{\zeta}_{1}
\end{pmatrix}\begin{pmatrix}
0 & 0 \\
1 & -1 \\
2 & 0 \\
1 & 1
\end{pmatrix} \\[1ex]
 & =\dfrac{1}{4}\begin{pmatrix}
1-{\zeta}_{2}+2+2{\zeta}_{2}-1-{\zeta}_{2} &  -1+{\zeta}_{2}-1-{\zeta}_{2} \\
-1-{\zeta}_{1}+2+2{\zeta}_{1}+1-{\zeta}_{1} & 1+{\zeta}_{1}+1-{\zeta}_{1}
\end{pmatrix} \\[1ex]
 & =\dfrac{1}{4}\begin{pmatrix}
2 & -2 \\
2 & 2
\end{pmatrix} \\[1ex]
 & =\dfrac{1}{2}\begin{pmatrix}
1 & -1 \\
1 & 1
\end{pmatrix}
\end{aligned}$$
והדטרמיננטה:
$$\begin{aligned}
\det(\mathbf{J}) & =\dfrac{1}{2}\cdot \dfrac{1}{2}-\left( -\dfrac{1}{2} \right)\cdot \dfrac{1}{2} \\[1ex]
 & =\dfrac{1}{2}
\end{aligned}$$

ההופכית:
$$\begin{aligned}
\,[ \mathbf{J}]^{-1}  & = \frac{1}{1/2} \begin{pmatrix}
1/2 & -1/2 \\
1/2 & 1/2
\end{pmatrix}  \\[1ex]
 & = 2 \begin{pmatrix}
1/2 & -1/2 \\
1/2 & 1/2
\end{pmatrix}  \\[1ex]
 & = \begin{pmatrix}
1 & -1 \\
1 & 1
\end{pmatrix}
\end{aligned} $$

**מטריצת הקשיחות**:
התרומה הנפחית למטריצת הקשיחות מחושבת באמצעות הנוסחה:
$$[\mathbf{K}]_{\text{domain}} = \int_{-1}^{1}\int_{-1}^{1} k[\hat{\mathbf{B}}]^{T}[\mathbf{J}]^{-T}[\mathbf{J}^{-1}]\hat{\mathbf{B}} |\det(\mathbf{J})| \mathrm{d}\zeta_1\mathrm{d}\zeta_2$$
כאשר במקרה שלנו $k=1$. מצאנו כי $[\mathbf{J}]^{-T}[\mathbf{J}]^{-1} = 2[\mathbf{I}]$ וגם $|\det(\mathbf{J})| = 1/2$. לכן:
$$[\mathbf{K}]_{\text{domain}} = \int_{-1}^{1}\int_{-1}^{1} [\hat{\mathbf{B}}]^{T} \hat{\mathbf{B}}\, \mathrm{d}\zeta_1\mathrm{d}\zeta_2$$
כעת, נחשב אינטגרל זה באמצעות אינטגרציית גאוס עם נקודה בודדת. נקודת הדגימה היא $(\zeta_1, \zeta_2) = (0,0)$ והמשקל הוא $w_1 w_2 = 2 \times 2 = 4$.
לכן:
$$[\mathbf{K}]_{\text{domain}} = 4 \left( [\hat{\mathbf{B}}]^{T} \hat{\mathbf{B}} \right) \Big|_{(\zeta_1, \zeta_2)=(0,0)}$$
ראשית, נחשב את $[\hat{\mathbf{B}}]$ בנקודה $(0,0)$:
$$[\hat{\mathbf{B}}]_{(0,0)} =\dfrac{1}{4}\begin{pmatrix}
-1 & 1 & 1 & -1 \\
-1 & -1 & 1 & 1
\end{pmatrix}$$
כעת נחשב את המכפלה $[\hat{\mathbf{B}}]^{T} [\hat{\mathbf{B}}]$ בנקודה $(0,0)$:
$$\begin{aligned}
\,[\hat{\mathbf{B}}]^{T}_{(0,0)} [\hat{\mathbf{B}}]_{(0,0)}  & = \dfrac{1}{16} \begin{pmatrix}
-1 & -1 \\
1 & -1 \\
1 & 1 \\
-1 & 1
\end{pmatrix}
\begin{pmatrix}
-1 & 1 & 1 & -1 \\
-1 & -1 & 1 & 1
\end{pmatrix}  \\[1ex]
 & = \dfrac{1}{16} \begin{pmatrix}
2 & 0 & -2 & 0 \\
0 & 2 & 0 & -2 \\
-2 & 0 & 2 & 0 \\
0 & -2 & 0 & 2
\end{pmatrix}
\end{aligned}$$
לבסוף, נכפיל במשקל האינטגרציה:
$$\begin{aligned}
\,[\mathbf{K}]_{\text{domain}}  & = 4 \cdot \dfrac{1}{16} \begin{pmatrix}
2 & 0 & -2 & 0 \\
0 & 2 & 0 & -2 \\
-2 & 0 & 2 & 0 \\
0 & -2 & 0 & 2
\end{pmatrix}   \\[2ex]
 & = \dfrac{1}{4} \begin{pmatrix}
2 & 0 & -2 & 0 \\
0 & 2 & 0 & -2 \\
-2 & 0 & 2 & 0 \\
0 & -2 & 0 & 2
\end{pmatrix}  \\[2ex]
 & = \begin{pmatrix}
0.5 & 0 & -0.5 & 0 \\
0 & 0.5 & 0 & -0.5 \\
-0.5 & 0 & 0.5 & 0 \\
0 & -0.5 & 0 & 0.5
\end{pmatrix}
\end{aligned}$$

**תרומת תנאי רובין**:
על הקטעים $P_1P_2$ ו-$P_1P_4$ (שהם $\Gamma_t$), מתרומת תנאי הרובין:
$$[\mathbf{K}]_{\text{Robin}} = \begin{pmatrix} 
4/3 & 1/3 & 0 & 1/3 \\[1ex]
1/3 & 2/3 & 0 & 0 \\[1ex]
0 & 0 & 0 & 0 \\[1ex]
1/3 & 0 & 0 & 2/3
\end{pmatrix}$$

**מטריצת הקשיחות הכוללת**:
$$\begin{aligned}
\,[\mathbf{K}]  & = [\mathbf{K}]_{\text{domain}} + [\mathbf{K}]_{\text{Robin}}  \\[2ex]
 & = \begin{pmatrix}
0.5 & 0 & -0.5 & 0 \\
0 & 0.5 & 0 & -0.5 \\
-0.5 & 0 & 0.5 & 0 \\
0 & -0.5 & 0 & 0.5
\end{pmatrix} + \dfrac{1}{6} \begin{pmatrix}
8 & 2 & 0 & 2 \\
2 & 4 & 0 & 0 \\
0 & 0 & 0 & 0 \\
2 & 0 & 0 & 4
\end{pmatrix} \\[2ex]
& = \begin{pmatrix}
0.5 + 8/6 & 0 + 2/6 & -0.5 + 0 & 0 + 2/6 \\
0 + 2/6 & 0.5 + 4/6 & 0 + 0 & -0.5 + 0 \\
-0.5 + 0 & 0 + 0 & 0.5 + 0 & 0 + 0 \\
0 + 2/6 & -0.5 + 0 & 0 + 0 & 0.5 + 4/6
\end{pmatrix} \\[2ex]
& = \begin{pmatrix}
3/6 + 8/6 & 2/6 & -3/6 & 2/6 \\
2/6 & 3/6 + 4/6 & 0 & -3/6 \\
-3/6 & 0 & 3/6 & 0 \\
2/6 & -3/6 & 0 & 3/6 + 4/6
\end{pmatrix}  \\[2ex]
 & = \begin{pmatrix}
11/6 & 1/3 & -1/2 & 1/3 \\
1/3 & 7/6 & 0 & -1/2 \\
-1/2 & 0 & 1/2 & 0 \\
1/3 & -1/2 & 0 & 7/6
\end{pmatrix}
\end{aligned}
 $$

**וקטור העומס**:
מהאינטגרל השפתי על $\Gamma_t$ עם $q''_s = 2\sqrt{2}(1-2x)$:
$$\{\mathbf{R}\} = \begin{pmatrix} 4/3 \\ -2/3 \\ 0 \\ -2/3 \end{pmatrix}$$

**החלת תנאי שפה דיריכלה**:
על $\Gamma_u$, $T = 2x - 3$:
$$\begin{aligned}
a_2 &= T(1,-1) = 2(1) - 3 = -1 \\[1ex]
a_3 &= T(2,0) = 2(2) - 3 = 1 \\[1ex]
a_4 &= T(1,1) = 2(1) - 3 = -1
\end{aligned}$$

מהמשוואה הראשונה:
$$\begin{gathered}
K_{11}a_1 + K_{12}a_2 + K_{13}a_3 + K_{14}a_4 = R_1 \\[1ex]
(11/6)a_1 + (1/3)a_2 + (-1/2)a_3 + (1/3)a_4 = 4/3 \\[1ex]
(11/6)a_1 + (1/3)(-1) + (-1/2)(1) + (1/3)(-1) = 4/3 \\[1ex]
(11/6)a_1 - 2/6 - 3/6 - 2/6 = 8/6 \\[1ex]
(11/6)a_1 = 15/6 \\[1ex]
11 a_1 = 15 \\[1ex]
a_1 = 15/11
\end{gathered}$$

לכן הפתרון הסופי:
$$\boxed {
\{ \mathbf{a} \}=\begin{pmatrix}
15/11 \\ -1 \\ 1 \\ -1
\end{pmatrix}^{T}
}$$
